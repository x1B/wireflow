define(['exports', 'module', '../polyfill/object-assign'], function (exports, module, _polyfillObjectAssign) {
  'use strict';

  module.exports = dragdrop;
  var abs = Math.abs;

  var dragThreshold = 3;

  function dragdrop(options) {

    var noOp = function noOp() {
      return true;
    };
    var doc = window.document;

    var _Object$assign = Object.assign({
      onBeforeStart: noOp,
      onStart: noOp,
      onMove: noOp,
      onCancel: noOp,
      onDrop: noOp,
      onEnd: noOp,
      onClick: noOp,
      containerNode: doc.documentElement,
      getDropResult: null
    }, options);

    var onBeforeStart = _Object$assign.onBeforeStart;
    var onStart = _Object$assign.onStart;
    var onMove = _Object$assign.onMove;
    var onCancel = _Object$assign.onCancel;
    var onDrop = _Object$assign.onDrop;
    var onEnd = _Object$assign.onEnd;
    var onClick = _Object$assign.onClick;
    var containerNode = _Object$assign.containerNode;
    var getDropResult = _Object$assign.getDropResult;

    // drag state:
    var dragStarted = false;
    var startClientX = 0;
    var startClientY = 0;
    var dragX = 0;
    var dragY = 0;

    var dragPayload = undefined;
    var dragNode = undefined;
    var dropResult = undefined;
    var dropNode = undefined;

    return { start: start };

    function start(ev, payload, node) {
      // we still need a minimum distance for actual drag
      dragStarted = false;
      var isLeftButton = ev.button === 0;
      var isTouch = (ev.targetTouches || []).length;
      if ((isLeftButton || isTouch) && onBeforeStart(ev)) {
        dragNode = node || ev.currentTarget;
        dragPayload = payload;

        var _ref = isTouch ? ev.targetTouches[0] : ev;

        var clientX = _ref.clientX;
        var clientY = _ref.clientY;
        startClientX = clientX;
        startClientY = clientY;

        doc.addEventListener('click', maybeClick);
        doc.addEventListener('mousemove', move);
        doc.addEventListener('touchmove', move);
        doc.addEventListener('mouseup', tryDrop);
        doc.addEventListener('touchend', tryDrop);
        doc.addEventListener('touchcancel', cancel);
        ev.preventDefault();
      }
    }

    function move(ev) {
      var isTouch = (ev.targetTouches || []).length;

      var _ref2 = isTouch ? ev.targetTouches[0] : ev;

      var clientX = _ref2.clientX;
      var clientY = _ref2.clientY;

      dragX = clientX - startClientX;
      dragY = clientY - startClientY;

      if (!dragStarted && abs(dragX) < dragThreshold && abs(dragY) < dragThreshold) {
        return;
      }

      if (!dragStarted) {
        onStart(ev);
        dragStarted = true;
      }

      var _anyDropResult = anyDropResult(clientX, clientY);

      var node = _anyDropResult.node;
      var result = _anyDropResult.result;

      dropNode = node;
      dropResult = result;
      onMove(state(), ev);
    }

    function cancel(ev) {
      onCancel(state(), ev);
      end(ev);
    }

    function tryDrop(ev) {
      (dropResult ? onDrop : onCancel)(state(), ev);
      end(ev);
    }

    function end(ev) {
      doc.removeEventListener('mousemove', move);
      doc.removeEventListener('touchmove', move);
      doc.removeEventListener('mouseup', tryDrop);
      doc.removeEventListener('touchend', tryDrop);
      doc.removeEventListener('touchcancel', cancel);
      dragPayload = dropNode = dropResult = null;
      onEnd(state(), ev);
    }

    function maybeClick(ev) {
      doc.removeEventListener('click', maybeClick);
      if (!dragStarted) {
        onClick(ev);
      }
    }

    function anyDropResult(clientX, clientY) {
      var node = null;
      var result = null;
      if (!getDropResult) {
        return { node: node, result: result };
      }

      node = doc.elementFromPoint(clientX, clientY);
      while (node && node !== containerNode) {
        result = getDropResult(node, dragPayload);
        // truthy: use as result
        if (result) {
          break;
        }
        // false: cancel looking immediately
        if (result === false) {
          node = null;
          break;
        }
        // falsy but not false: keep looking
        node = node.parentNode;
      }
      return { node: node, result: result };
    }

    function state() {
      return {
        dragPayload: dragPayload,
        dragNode: dragNode,
        dragX: dragX,
        dragY: dragY,
        dropResult: dropResult,
        dropNode: dropNode
      };
    }
  }
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9Vc2Vycy9taWNoYWVsL3dvcmsvZ2l0aHViLmNvbS94MUIvbmJlLXJlYWN0L3NyYy91dGlsL2RyYWdkcm9wLmpzeCJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7bUJBS3dCLFFBQVE7TUFIeEIsR0FBRyxHQUFLLElBQUksQ0FBWixHQUFHOztBQUNYLE1BQU0sYUFBYSxHQUFHLENBQUMsQ0FBQzs7QUFFVCxXQUFTLFFBQVEsQ0FBRSxPQUFPLEVBQUc7O0FBRTFDLFFBQU0sSUFBSSxHQUFHLFNBQVAsSUFBSTthQUFTLElBQUk7S0FBQSxDQUFDO0FBQ3hCLFFBQU0sR0FBRyxHQUFHLE1BQU0sQ0FBQyxRQUFRLENBQUM7O3lCQVl4QixNQUFNLENBQUMsTUFBTSxDQUFFO0FBQ2pCLG1CQUFhLEVBQUUsSUFBSTtBQUNuQixhQUFPLEVBQUUsSUFBSTtBQUNiLFlBQU0sRUFBRSxJQUFJO0FBQ1osY0FBUSxFQUFFLElBQUk7QUFDZCxZQUFNLEVBQUUsSUFBSTtBQUNaLFdBQUssRUFBRSxJQUFJO0FBQ1gsYUFBTyxFQUFFLElBQUk7QUFDYixtQkFBYSxFQUFFLEdBQUcsQ0FBQyxlQUFlO0FBQ2xDLG1CQUFhLEVBQUUsSUFBSTtLQUNwQixFQUFFLE9BQU8sQ0FBRTs7UUFuQlYsYUFBYSxrQkFBYixhQUFhO1FBQ2IsT0FBTyxrQkFBUCxPQUFPO1FBQ1AsTUFBTSxrQkFBTixNQUFNO1FBQ04sUUFBUSxrQkFBUixRQUFRO1FBQ1IsTUFBTSxrQkFBTixNQUFNO1FBQ04sS0FBSyxrQkFBTCxLQUFLO1FBQ0wsT0FBTyxrQkFBUCxPQUFPO1FBQ1AsYUFBYSxrQkFBYixhQUFhO1FBQ2IsYUFBYSxrQkFBYixhQUFhOzs7QUFjZixRQUFJLFdBQVcsR0FBRyxLQUFLLENBQUM7QUFDeEIsUUFBSSxZQUFZLEdBQUcsQ0FBQyxDQUFDO0FBQ3JCLFFBQUksWUFBWSxHQUFHLENBQUMsQ0FBQztBQUNyQixRQUFJLEtBQUssR0FBRyxDQUFDLENBQUM7QUFDZCxRQUFJLEtBQUssR0FBRyxD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LE9BQU8sRUFBRSxPQUFPLENBQUUsQ0FBQztBQUNoRCxhQUFPLElBQUksSUFBSSxJQUFJLEtBQUssYUFBYSxFQUFHO0FBQ3RDLGNBQU0sR0FBRyxhQUFhLENBQUUsSUFBSSxFQUFFLFdBQVcsQ0FBRSxDQUFDOztBQUU1QyxZQUFJLE1BQU0sRUFBRztBQUNYLGdCQUFNO1NBQ1A7O0FBRUQsWUFBSSxNQUFNLEtBQUssS0FBSyxFQUFHO0FBQ3JCLGNBQUksR0FBRyxJQUFJLENBQUM7QUFDWixnQkFBTTtTQUNQOztBQUVELFlBQUksR0FBRyxJQUFJLENBQUMsVUFBVSxDQUFDO09BQ3hCO0FBQ0QsYUFBTyxFQUFFLElBQUksRUFBSixJQUFJLEVBQUUsTUFBTSxFQUFOLE1BQU0sRUFBRSxDQUFDO0tBQ3pCOztBQUdELGFBQVMsS0FBSyxHQUFHO0FBQ2YsYUFBTztBQUNMLG1CQUFXLEVBQVgsV0FBVztBQUNYLGdCQUFRLEVBQVIsUUFBUTtBQUNSLGFBQUssRUFBTCxLQUFLO0FBQ0wsYUFBSyxFQUFMLEtBQUs7QUFDTCxrQkFBVSxFQUFWLFVBQVU7QUFDVixnQkFBUSxFQUFSLFFBQVE7T0FDVCxDQUFDO0tBQ0g7R0FDRiIsImZpbGUiOiIvVXNlcnMvbWljaGFlbC93b3JrL2dpdGh1Yi5jb20veDFCL25iZS1yZWFjdC9zcmMvdXRpbC9kcmFnZHJvcC5qc3giLCJzb3VyY2VSb290Ijoic3JjIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0ICcuLi9wb2x5ZmlsbC9vYmplY3QtYXNzaWduJztcblxuY29uc3QgeyBhYnMgfSA9IE1hdGg7XG5jb25zdCBkcmFnVGhyZXNob2xkID0gMztcblxuZXhwb3J0IGRlZmF1bHQgZnVuY3Rpb24gZHJhZ2Ryb3AoIG9wdGlvbnMgKSB7XG5cbiAgY29uc3Qgbm9PcCA9ICgpID0+IHRydWU7XG4gIGNvbnN0IGRvYyA9IHdpbmRvdy5kb2N1bWVudDtcblxuICBjb25zdCB7XG4gICAgb25CZWZvcmVTdGFydCxcbiAgICBvblN0YXJ0LFxuICAgIG9uTW92ZSxcbiAgICBvbkNhbmNlbCxcbiAgICBvbkRyb3AsXG4gICAgb25FbmQsXG4gICAgb25DbGljayxcbiAgICBjb250YWluZXJOb2RlLFxuICAgIGdldERyb3BSZXN1bHRcbiAgfSA9IE9iamVjdC5hc3NpZ24oIHtcbiAgICBvbkJlZm9yZVN0YXJ0OiBub09wLFxuICAgIG9uU3RhcnQ6IG5vT3AsXG4gICAgb25Nb3ZlOiBub09wLFxuICAgIG9uQ2FuY2VsOiBub09wLFxuICAgIG9uRHJvcDogbm9PcCxcbiAgICBvbkVuZDogbm9PcCxcbiAgICBvbkNsaWNrOiBub09wLFxuICAgIGNvbnRhaW5lck5vZGU6IGRvYy5kb2N1bWVudEVsZW1lbnQsXG4gICAgZ2V0RHJvcFJlc3VsdDogbnVsbFxuICB9LCBvcHRpb25zICk7XG5cbiAgLy8gZHJhZyBzdGF0ZTpcbiAgbGV0IGRyYWdTdGFydGVkID0gZmFsc2U7XG4gIGxldCBzdGFydENsaWVudFggPSAwO1xuICBsZXQgc3RhcnRDbGllbnRZID0gMDtcbiAgbGV0IGRyYWdYID0gMDtcbiAgbGV0IGRyYWdZID0gMDtcblxuICBsZXQgZHJhZ1BheWxvYWQ7XG4gIGxldCBkcmFnTm9kZTtcbiAgbGV0IGRyb3BSZXN1bHQ7XG4gIGxldCBkcm9wTm9kZTtcblxuICByZXR1cm4geyBzdGFydCB9O1xuXG5cbiAgZnVuY3Rpb24gc3RhcnQoIGV2LCBwYXlsb2FkLCBub2RlICkge1xuICAgIC8vIHdlIHN0aWxsIG5lZWQgYSBtaW5pbXVtIGRpc3RhbmNlIGZvciBhY3R1YWwgZHJhZ1xuICAgIGRyYWdTdGFydGVkID0gZmFsc2U7XG4gICAgY29uc3QgaXNMZWZ0QnV0dG9uID0gZXYuYnV0dG9uID09PSAwO1xuICAgIGNvbnN0IGlzVG91Y2ggPSAoIGV2LnRhcmdldFRvdWNoZXMgfHwgW10gKS5sZW5ndGg7XG4gICAgaWYoIChpc0xlZnRCdXR0b24gfHwgaXNUb3VjaCkgJiYgb25CZWZvcmVTdGFydCggZXYgKSApIHtcbiAgICAgIGRyYWdOb2RlID0gbm9kZSB8fCBldi5jdXJyZW50VGFyZ2V0O1xuICAgICAgZHJhZ1BheWxvYWQgPSBwYXlsb2FkO1xuICAgICAgY29uc3QgeyBjbGllbnRYLCBjbGllbnRZIH0gPSBpc1RvdWNoID8gZXYudGFyZ2V0VG91Y2hlc1sgMCBdIDogZXY7XG4gICAgICBbIHN0YXJ0Q2xpZW50WCwgc3RhcnRDbGllbnRZIF0gPSBbIGNsaWVudFgsIGNsaWVudFkgXTtcblxuICAgICAgZG9jLmFkZEV2ZW50TGlzdGVuZXIoICdjbGljaycsIG1heWJlQ2xpY2sgKTtcbiAgICAgIGRvYy5hZGRFdmVudExpc3RlbmVyKCAnbW91c2Vtb3ZlJywgbW92ZSApO1xuICAgICAgZG9jLmFkZEV2ZW50TGlzdGVuZXIoICd0b3VjaG1vdmUnLCBtb3ZlICk7XG4gICAgICBkb2MuYWRkRXZlbnRMaXN0ZW5lciggJ21vdXNldXAnLCB0cnlEcm9wICk7XG4gICAgICBkb2MuYWRkRXZlbnRMaXN0ZW5lciggJ3RvdWNoZW5kJywgdHJ5RHJvcCApO1xuICAgICAgZG9jLmFkZEV2ZW50TGlzdGVuZXIoICd0b3VjaGNhbmNlbCcsIGNhbmNlbCApO1xuICAgICAgZXYucHJldmVudERlZmF1bHQoKTtcbiAgICB9XG4gIH1cblxuXG4gIGZ1bmN0aW9uIG1vdmUoIGV2ICkge1xuICAgIGNvbnN0IGlzVG91Y2ggPSAoIGV2LnRhcmdldFRvdWNoZXMgfHwgW10gKS5sZW5ndGg7XG4gICAgY29uc3QgeyBjbGllbnRYLCBjbGllbnRZIH0gPSBpc1RvdWNoID8gZXYudGFyZ2V0VG91Y2hlc1sgMCBdIDogZXY7XG4gICAgZHJhZ1ggPSBjbGllbnRYIC0gc3RhcnRDbGllbnRYO1xuICAgIGRyYWdZID0gY2xpZW50WSAtIHN0YXJ0Q2xpZW50WTtcblxuICAgIGlmKCAhZHJhZ1N0YXJ0ZWQgJiZcbiAgICAgICAgYWJzKCBkcmFnWCApIDwgZHJhZ1RocmVzaG9sZCAmJiBhYnMoIGRyYWdZICkgPCBkcmFnVGhyZXNob2xkICApIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBpZiggIWRyYWdTdGFydGVkICkge1xuICAgICAgb25TdGFydCggZXYgKTtcbiAgICAgIGRyYWdTdGFydGVkID0gdHJ1ZTtcbiAgICB9XG5cbiAgICBjb25zdCB7IG5vZGUsIHJlc3VsdCB9ID0gYW55RHJvcFJlc3VsdCggY2xpZW50WCwgY2xpZW50WSApO1xuICAgIGRyb3BOb2RlID0gbm9kZTtcbiAgICBkcm9wUmVzdWx0ID0gcmVzdWx0O1xuICAgIG9uTW92ZSggc3RhdGUoKSwgZXYgKTtcbiAgfVxuXG5cbiAgZnVuY3Rpb24gY2FuY2VsKCBldiApIHtcbiAgICBvbkNhbmNlbCggc3RhdGUoKSwgZXYgKTtcbiAgICBlbmQoIGV2ICk7XG4gIH1cblxuXG4gIGZ1bmN0aW9uIHRyeURyb3AoIGV2ICkge1xuICAgICggZHJvcFJlc3VsdCA/IG9uRHJvcCA6IG9uQ2FuY2VsICkoIHN0YXRlKCksIGV2ICk7XG4gICAgZW5kKCBldiApO1xuICB9XG5cblxuICBmdW5jdGlvbiBlbmQoIGV2ICkge1xuICAgIGRvYy5yZW1vdmVFdmVudExpc3RlbmVyKCAnbW91c2Vtb3ZlJywgbW92ZSApO1xuICAgIGRvYy5yZW1vdmVFdmVudExpc3RlbmVyKCAndG91Y2htb3ZlJywgbW92ZSApO1xuICAgIGRvYy5yZW1vdmVFdmVudExpc3RlbmVyKCAnbW91c2V1cCcsIHRyeURyb3AgKTtcbiAgICBkb2MucmVtb3ZlRXZlbnRMaXN0ZW5lciggJ3RvdWNoZW5kJywgdHJ5RHJvcCApO1xuICAgIGRvYy5yZW1vdmVFdmVudExpc3RlbmVyKCAndG91Y2hjYW5jZWwnLCBjYW5jZWwgKTtcbiAgICBkcmFnUGF5bG9hZCA9IGRyb3BOb2RlID0gZHJvcFJlc3VsdCA9IG51bGw7XG4gICAgb25FbmQoIHN0YXRlKCksIGV2ICk7XG4gIH1cblxuXG4gIGZ1bmN0aW9uIG1heWJlQ2xpY2soIGV2ICkge1xuICAgIGRvYy5yZW1vdmVFdmVudExpc3RlbmVyKCAnY2xpY2snLCBtYXliZUNsaWNrICk7XG4gICAgaWYoICFkcmFnU3RhcnRlZCApIHtcbiAgICAgIG9uQ2xpY2soIGV2ICk7XG4gICAgfVxuICB9XG5cblxuICBmdW5jdGlvbiBhbnlEcm9wUmVzdWx0KCBjbGllbnRYLCBjbGllbnRZICkge1xuICAgIGxldCBub2RlID0gbnVsbDtcbiAgICBsZXQgcmVzdWx0ID0gbnVsbDtcbiAgICBpZiggIWdldERyb3BSZXN1bHQgKSB7XG4gICAgICByZXR1cm4geyBub2RlLCByZXN1bHQgfTtcbiAgICB9XG5cbiAgICBub2RlID0gZG9jLmVsZW1lbnRGcm9tUG9pbnQoIGNsaWVudFgsIGNsaWVudFkgKTtcbiAgICB3aGlsZSggbm9kZSAmJiBub2RlICE9PSBjb250YWluZXJOb2RlICkge1xuICAgICAgcmVzdWx0ID0gZ2V0RHJvcFJlc3VsdCggbm9kZSwgZHJhZ1BheWxvYWQgKTtcbiAgICAgIC8vIHRydXRoeTogdXNlIGFzIHJlc3VsdFxuICAgICAgaWYoIHJlc3VsdCApIHtcbiAgICAgICAgYnJlYWs7XG4gICAgICB9XG4gICAgICAvLyBmYWxzZTogY2FuY2VsIGxvb2tpbmcgaW1tZWRpYXRlbHlcbiAgICAgIGlmKCByZXN1bHQgPT09IGZhbHNlICkge1xuICAgICAgICBub2RlID0gbnVsbDtcbiAgICAgICAgYnJlYWs7XG4gICAgICB9XG4gICAgICAvLyBmYWxzeSBidXQgbm90IGZhbHNlOiBrZWVwIGxvb2tpbmdcbiAgICAgIG5vZGUgPSBub2RlLnBhcmVudE5vZGU7XG4gICAgfVxuICAgIHJldHVybiB7IG5vZGUsIHJlc3VsdCB9O1xuICB9XG5cblxuICBmdW5jdGlvbiBzdGF0ZSgpIHtcbiAgICByZXR1cm4ge1xuICAgICAgZHJhZ1BheWxvYWQsXG4gICAgICBkcmFnTm9kZSxcbiAgICAgIGRyYWdYLFxuICAgICAgZHJhZ1ksXG4gICAgICBkcm9wUmVzdWx0LFxuICAgICAgZHJvcE5vZGVcbiAgICB9O1xuICB9XG59XG4iXX0=