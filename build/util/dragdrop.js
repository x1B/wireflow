define(['exports', 'module', '../polyfill/object-assign'], function (exports, module, _polyfillObjectAssign) {'use strict';module.exports = 





  dragdrop;var abs = Math.abs;var defaultDragThreshold = 3;function dragdrop(options) {

    var noOp = function noOp() {return true;};
    var doc = window.document;var _Object$assign = 












    Object.assign({ 
      onBeforeStart: noOp, 
      dragThreshold: defaultDragThreshold, 
      onStart: noOp, 
      onMove: noOp, 
      onCancel: noOp, 
      onDrop: noOp, 
      onEnd: noOp, 
      onClick: noOp, 
      containerNode: doc.documentElement, 
      getDropResult: null }, 
    options);var onBeforeStart = _Object$assign.onBeforeStart;var dragThreshold = _Object$assign.dragThreshold;var onStart = _Object$assign.onStart;var onMove = _Object$assign.onMove;var onCancel = _Object$assign.onCancel;var onDrop = _Object$assign.onDrop;var onEnd = _Object$assign.onEnd;var onClick = _Object$assign.onClick;var containerNode = _Object$assign.containerNode;var getDropResult = _Object$assign.getDropResult;

    // drag state:
    var dragStarted = false;
    var startClientX = 0;
    var startClientY = 0;
    var dragX = 0;
    var dragY = 0;

    var base = undefined;
    var dragPayload = undefined;
    var dragNode = undefined;
    var dropResult = undefined;
    var dropNode = undefined;

    return { start: start };


    function start(ev, payload, options) {
      // we still need a minimum distance for actual drag
      dragStarted = false;
      var isLeftButton = ev.button === 0;
      var isTouch = (ev.targetTouches || []).length;

      var pointerEvent = isTouch ? ev.targetTouches[0] : ev;var 
      clientX = pointerEvent.clientX;var clientY = pointerEvent.clientY;
      var target = options && options.target || pointerEvent.target;var _target$getBoundingClientRect = 

      target.getBoundingClientRect();var left = _target$getBoundingClientRect.left;var top = _target$getBoundingClientRect.top;
      var offsetX = clientX - left;
      var offsetY = clientY - top;
      if ((isLeftButton || isTouch) && onBeforeStart(ev, offsetX, offsetY)) {
        base = { baseX: offsetX, baseY: offsetY };
        dragNode = options && options.dragNode || ev.currentTarget;
        dragPayload = payload;
        startClientX = clientX;startClientY = clientY;

        doc.addEventListener('click', maybeClick);
        doc.addEventListener('mousemove', move);
        doc.addEventListener('touchmove', move);
        doc.addEventListener('mouseup', tryDrop);
        doc.addEventListener('touchend', tryDrop);
        doc.addEventListener('touchcancel', cancel);
        ev.preventDefault();}}




    function move(ev) {
      var isTouch = (ev.targetTouches || []).length;var _ref = 
      isTouch ? ev.targetTouches[0] : ev;var clientX = _ref.clientX;var clientY = _ref.clientY;
      dragX = clientX - startClientX;
      dragY = clientY - startClientY;

      if (!dragStarted && 
      abs(dragX) < dragThreshold && abs(dragY) < dragThreshold) {
        return;}


      if (!dragStarted) {
        onStart(ev);
        dragStarted = true;}var _anyDropResult = 


      anyDropResult(clientX, clientY);var node = _anyDropResult.node;var result = _anyDropResult.result;
      dropNode = node;
      dropResult = result;
      onMove(state(), ev);}



    function cancel(ev) {
      onCancel(state(), ev);
      end(ev);}



    function tryDrop(ev) {
      (dropResult ? onDrop : onCancel)(state(), ev);
      end(ev);}



    function end(ev) {
      doc.removeEventListener('mousemove', move);
      doc.removeEventListener('touchmove', move);
      doc.removeEventListener('mouseup', tryDrop);
      doc.removeEventListener('touchend', tryDrop);
      doc.removeEventListener('touchcancel', cancel);
      dragPayload = dropNode = dropResult = null;
      onEnd(state(), ev);}



    function maybeClick(ev) {
      doc.removeEventListener('click', maybeClick);
      if (!dragStarted) {
        onClick(ev);}}




    function anyDropResult(clientX, clientY) {
      var node = null;
      var result = null;
      if (!getDropResult) {
        return { node: node, result: result };}


      node = doc.elementFromPoint(clientX, clientY);
      while (node && node !== containerNode) {
        result = getDropResult(node, dragPayload);
        // truthy: use as result
        if (result) {
          break;}

        // false: cancel looking immediately
        if (result === false) {
          node = null;
          break;}

        // falsy but not false: keep looking
        node = node.parentNode;}

      return { node: node, result: result };}



    function state() {
      return { 
        base: base, 
        dragPayload: dragPayload, 
        dragNode: dragNode, 
        dragX: dragX, 
        dragY: dragY, 
        dropResult: dropResult, 
        dropNode: dropNode };}}});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy91dGlsL2RyYWdkcm9wLmpzeCJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7Ozs7QUFNd0IsVUFBUSxLQUh4QixHQUFHLEdBQUssSUFBSSxDQUFaLEdBQUcsQ0FDWCxJQUFNLG9CQUFvQixHQUFHLENBQUMsQ0FBQyxBQUVoQixTQUFTLFFBQVEsQ0FBRSxPQUFPLEVBQUc7O0FBRTFDLFFBQU0sSUFBSSxHQUFHLFNBQVAsSUFBSSxXQUFTLElBQUksRUFBQSxDQUFDO0FBQ3hCLFFBQU0sR0FBRyxHQUFHLE1BQU0sQ0FBQyxRQUFRLENBQUM7Ozs7Ozs7Ozs7Ozs7QUFheEIsVUFBTSxDQUFDLE1BQU0sQ0FBRTtBQUNqQixtQkFBYSxFQUFFLElBQUk7QUFDbkIsbUJBQWEsRUFBRSxvQkFBb0I7QUFDbkMsYUFBTyxFQUFFLElBQUk7QUFDYixZQUFNLEVBQUUsSUFBSTtBQUNaLGNBQVEsRUFBRSxJQUFJO0FBQ2QsWUFBTSxFQUFFLElBQUk7QUFDWixXQUFLLEVBQUUsSUFBSTtBQUNYLGFBQU8sRUFBRSxJQUFJO0FBQ2IsbUJBQWEsRUFBRSxHQUFHLENBQUMsZUFBZTtBQUNsQyxtQkFBYSxFQUFFLElBQUksRUFDcEI7QUFBRSxXQUFPLENBQUUsS0FyQlYsYUFBYSxrQkFBYixhQUFhLEtBQ2IsYUFBYSxrQkFBYixhQUFhLEtBQ2IsT0FBTyxrQkFBUCxPQUFPLEtBQ1AsTUFBTSxrQkFBTixNQUFNLEtBQ04sUUFBUSxrQkFBUixRQUFRLEtBQ1IsTUFBTSxrQkFBTixNQUFNLEtBQ04sS0FBSyxrQkFBTCxLQUFLLEtBQ0wsT0FBTyxrQkFBUCxPQUFPLEtBQ1AsYUFBYSxrQkFBYixhQUFhLEtBQ2IsYUFBYSxrQkFBYixhQUFhOzs7QUFlZixRQUFJLFdBQVcsR0FBRyxLQUFLLENBQUM7QUFDeEIsUUFBSSxZQUFZLEdBQUcsQ0FBQyxDQUFDO0FBQ3JCLFFBQUksWUFBWSxHQUFHLENBQUMsQ0FBQztBQUNyQixRQUFJLEtBQUssR0FBRyxDQUFDLENBQUM7QUFD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LEVBQUwsS0FBSztBQUNMLGtCQUFVLEVBQVYsVUFBVTtBQUNWLGdCQUFRLEVBQVIsUUFBUSxFQUNULENBQUMsQ0FDSCxDQUNGIiwiZmlsZSI6ImRyYWdkcm9wLmpzIiwic291cmNlUm9vdCI6InNyYyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCAnLi4vcG9seWZpbGwvb2JqZWN0LWFzc2lnbic7XG5cblxuY29uc3QgeyBhYnMgfSA9IE1hdGg7XG5jb25zdCBkZWZhdWx0RHJhZ1RocmVzaG9sZCA9IDM7XG5cbmV4cG9ydCBkZWZhdWx0IGZ1bmN0aW9uIGRyYWdkcm9wKCBvcHRpb25zICkge1xuXG4gIGNvbnN0IG5vT3AgPSAoKSA9PiB0cnVlO1xuICBjb25zdCBkb2MgPSB3aW5kb3cuZG9jdW1lbnQ7XG5cbiAgY29uc3Qge1xuICAgIG9uQmVmb3JlU3RhcnQsXG4gICAgZHJhZ1RocmVzaG9sZCxcbiAgICBvblN0YXJ0LFxuICAgIG9uTW92ZSxcbiAgICBvbkNhbmNlbCxcbiAgICBvbkRyb3AsXG4gICAgb25FbmQsXG4gICAgb25DbGljayxcbiAgICBjb250YWluZXJOb2RlLFxuICAgIGdldERyb3BSZXN1bHRcbiAgfSA9IE9iamVjdC5hc3NpZ24oIHtcbiAgICBvbkJlZm9yZVN0YXJ0OiBub09wLFxuICAgIGRyYWdUaHJlc2hvbGQ6IGRlZmF1bHREcmFnVGhyZXNob2xkLFxuICAgIG9uU3RhcnQ6IG5vT3AsXG4gICAgb25Nb3ZlOiBub09wLFxuICAgIG9uQ2FuY2VsOiBub09wLFxuICAgIG9uRHJvcDogbm9PcCxcbiAgICBvbkVuZDogbm9PcCxcbiAgICBvbkNsaWNrOiBub09wLFxuICAgIGNvbnRhaW5lck5vZGU6IGRvYy5kb2N1bWVudEVsZW1lbnQsXG4gICAgZ2V0RHJvcFJlc3VsdDogbnVsbFxuICB9LCBvcHRpb25zICk7XG5cbiAgLy8gZHJhZyBzdGF0ZTpcbiAgbGV0IGRyYWdTdGFydGVkID0gZmFsc2U7XG4gIGxldCBzdGFydENsaWVudFggPSAwO1xuICBsZXQgc3RhcnRDbGllbnRZID0gMDtcbiAgbGV0IGRyYWdYID0gMDtcbiAgbGV0IGRyYWdZID0gMDtcblxuICBsZXQgYmFzZTtcbiAgbGV0IGRyYWdQYXlsb2FkO1xuICBsZXQgZHJhZ05vZGU7XG4gIGxldCBkcm9wUmVzdWx0O1xuICBsZXQgZHJvcE5vZGU7XG5cbiAgcmV0dXJuIHsgc3RhcnQgfTtcblxuXG4gIGZ1bmN0aW9uIHN0YXJ0KCBldiwgcGF5bG9hZCwgb3B0aW9ucyApIHtcbiAgICAvLyB3ZSBzdGlsbCBuZWVkIGEgbWluaW11bSBkaXN0YW5jZSBmb3IgYWN0dWFsIGRyYWdcbiAgICBkcmFnU3RhcnRlZCA9IGZhbHNlO1xuICAgIGNvbnN0IGlzTGVmdEJ1dHRvbiA9IGV2LmJ1dHRvbiA9PT0gMDtcbiAgICBjb25zdCBpc1RvdWNoID0gKCBldi50YXJnZXRUb3VjaGVzIHx8IFtdICkubGVuZ3RoO1xuXG4gICAgY29uc3QgcG9pbnRlckV2ZW50ID0gaXNUb3VjaCA/IGV2LnRhcmdldFRvdWNoZXNbIDAgXSA6IGV2O1xuICAgIGNvbnN0IHsgY2xpZW50WCwgY2xpZW50WSB9ID0gcG9pbnRlckV2ZW50O1xuICAgIGNvbnN0IHRhcmdldCA9ICggb3B0aW9ucyAmJiBvcHRpb25zLnRhcmdldCApIHx8IHBvaW50ZXJFdmVudC50YXJnZXQ7XG5cbiAgICBjb25zdCB7IGxlZnQsIHRvcCB9ID0gdGFyZ2V0LmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpO1xuICAgIGNvbnN0IG9mZnNldFggPSBjbGllbnRYIC0gbGVmdDtcbiAgICBjb25zdCBvZmZzZXRZID0gY2xpZW50WSAtIHRvcDtcbiAgICBpZiggKGlzTGVmdEJ1dHRvbiB8fCBpc1RvdWNoKSAmJiBvbkJlZm9yZVN0YXJ0KCBldiwgb2Zmc2V0WCwgb2Zmc2V0WSApICkge1xuICAgICAgYmFzZSA9IHsgYmFzZVg6IG9mZnNldFgsIGJhc2VZOiBvZmZzZXRZIH07XG4gICAgICBkcmFnTm9kZSA9ICggb3B0aW9ucyAmJiBvcHRpb25zLmRyYWdOb2RlICkgfHwgZXYuY3VycmVudFRhcmdldDtcbiAgICAgIGRyYWdQYXlsb2FkID0gcGF5bG9hZDtcbiAgICAgIFsgc3RhcnRDbGllbnRYLCBzdGFydENsaWVudFkgXSA9IFsgY2xpZW50WCwgY2xpZW50WSBdO1xuXG4gICAgICBkb2MuYWRkRXZlbnRMaXN0ZW5lciggJ2NsaWNrJywgbWF5YmVDbGljayApO1xuICAgICAgZG9jLmFkZEV2ZW50TGlzdGVuZXIoICdtb3VzZW1vdmUnLCBtb3ZlICk7XG4gICAgICBkb2MuYWRkRXZlbnRMaXN0ZW5lciggJ3RvdWNobW92ZScsIG1vdmUgKTtcbiAgICAgIGRvYy5hZGRFdmVudExpc3RlbmVyKCAnbW91c2V1cCcsIHRyeURyb3AgKTtcbiAgICAgIGRvYy5hZGRFdmVudExpc3RlbmVyKCAndG91Y2hlbmQnLCB0cnlEcm9wICk7XG4gICAgICBkb2MuYWRkRXZlbnRMaXN0ZW5lciggJ3RvdWNoY2FuY2VsJywgY2FuY2VsICk7XG4gICAgICBldi5wcmV2ZW50RGVmYXVsdCgpO1xuICAgIH1cbiAgfVxuXG5cbiAgZnVuY3Rpb24gbW92ZSggZXYgKSB7XG4gICAgY29uc3QgaXNUb3VjaCA9ICggZXYudGFyZ2V0VG91Y2hlcyB8fCBbXSApLmxlbmd0aDtcbiAgICBjb25zdCB7IGNsaWVudFgsIGNsaWVudFkgfSA9IGlzVG91Y2ggPyBldi50YXJnZXRUb3VjaGVzWyAwIF0gOiBldjtcbiAgICBkcmFnWCA9IGNsaWVudFggLSBzdGFydENsaWVudFg7XG4gICAgZHJhZ1kgPSBjbGllbnRZIC0gc3RhcnRDbGllbnRZO1xuXG4gICAgaWYoICFkcmFnU3RhcnRlZCAmJlxuICAgICAgICBhYnMoIGRyYWdYICkgPCBkcmFnVGhyZXNob2xkICYmIGFicyggZHJhZ1kgKSA8IGRyYWdUaHJlc2hvbGQgKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgaWYoICFkcmFnU3RhcnRlZCApIHtcbiAgICAgIG9uU3RhcnQoIGV2ICk7XG4gICAgICBkcmFnU3RhcnRlZCA9IHRydWU7XG4gICAgfVxuXG4gICAgY29uc3QgeyBub2RlLCByZXN1bHQgfSA9IGFueURyb3BSZXN1bHQoIGNsaWVudFgsIGNsaWVudFkgKTtcbiAgICBkcm9wTm9kZSA9IG5vZGU7XG4gICAgZHJvcFJlc3VsdCA9IHJlc3VsdDtcbiAgICBvbk1vdmUoIHN0YXRlKCksIGV2ICk7XG4gIH1cblxuXG4gIGZ1bmN0aW9uIGNhbmNlbCggZXYgKSB7XG4gICAgb25DYW5jZWwoIHN0YXRlKCksIGV2ICk7XG4gICAgZW5kKCBldiApO1xuICB9XG5cblxuICBmdW5jdGlvbiB0cnlEcm9wKCBldiApIHtcbiAgICAoIGRyb3BSZXN1bHQgPyBvbkRyb3AgOiBvbkNhbmNlbCApKCBzdGF0ZSgpLCBldiApO1xuICAgIGVuZCggZXYgKTtcbiAgfVxuXG5cbiAgZnVuY3Rpb24gZW5kKCBldiApIHtcbiAgICBkb2MucmVtb3ZlRXZlbnRMaXN0ZW5lciggJ21vdXNlbW92ZScsIG1vdmUgKTtcbiAgICBkb2MucmVtb3ZlRXZlbnRMaXN0ZW5lciggJ3RvdWNobW92ZScsIG1vdmUgKTtcbiAgICBkb2MucmVtb3ZlRXZlbnRMaXN0ZW5lciggJ21vdXNldXAnLCB0cnlEcm9wICk7XG4gICAgZG9jLnJlbW92ZUV2ZW50TGlzdGVuZXIoICd0b3VjaGVuZCcsIHRyeURyb3AgKTtcbiAgICBkb2MucmVtb3ZlRXZlbnRMaXN0ZW5lciggJ3RvdWNoY2FuY2VsJywgY2FuY2VsICk7XG4gICAgZHJhZ1BheWxvYWQgPSBkcm9wTm9kZSA9IGRyb3BSZXN1bHQgPSBudWxsO1xuICAgIG9uRW5kKCBzdGF0ZSgpLCBldiApO1xuICB9XG5cblxuICBmdW5jdGlvbiBtYXliZUNsaWNrKCBldiApIHtcbiAgICBkb2MucmVtb3ZlRXZlbnRMaXN0ZW5lciggJ2NsaWNrJywgbWF5YmVDbGljayApO1xuICAgIGlmKCAhZHJhZ1N0YXJ0ZWQgKSB7XG4gICAgICBvbkNsaWNrKCBldiApO1xuICAgIH1cbiAgfVxuXG5cbiAgZnVuY3Rpb24gYW55RHJvcFJlc3VsdCggY2xpZW50WCwgY2xpZW50WSApIHtcbiAgICBsZXQgbm9kZSA9IG51bGw7XG4gICAgbGV0IHJlc3VsdCA9IG51bGw7XG4gICAgaWYoICFnZXREcm9wUmVzdWx0ICkge1xuICAgICAgcmV0dXJuIHsgbm9kZSwgcmVzdWx0IH07XG4gICAgfVxuXG4gICAgbm9kZSA9IGRvYy5lbGVtZW50RnJvbVBvaW50KCBjbGllbnRYLCBjbGllbnRZICk7XG4gICAgd2hpbGUoIG5vZGUgJiYgbm9kZSAhPT0gY29udGFpbmVyTm9kZSApIHtcbiAgICAgIHJlc3VsdCA9IGdldERyb3BSZXN1bHQoIG5vZGUsIGRyYWdQYXlsb2FkICk7XG4gICAgICAvLyB0cnV0aHk6IHVzZSBhcyByZXN1bHRcbiAgICAgIGlmKCByZXN1bHQgKSB7XG4gICAgICAgIGJyZWFrO1xuICAgICAgfVxuICAgICAgLy8gZmFsc2U6IGNhbmNlbCBsb29raW5nIGltbWVkaWF0ZWx5XG4gICAgICBpZiggcmVzdWx0ID09PSBmYWxzZSApIHtcbiAgICAgICAgbm9kZSA9IG51bGw7XG4gICAgICAgIGJyZWFrO1xuICAgICAgfVxuICAgICAgLy8gZmFsc3kgYnV0IG5vdCBmYWxzZToga2VlcCBsb29raW5nXG4gICAgICBub2RlID0gbm9kZS5wYXJlbnROb2RlO1xuICAgIH1cbiAgICByZXR1cm4geyBub2RlLCByZXN1bHQgfTtcbiAgfVxuXG5cbiAgZnVuY3Rpb24gc3RhdGUoKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIGJhc2UsXG4gICAgICBkcmFnUGF5bG9hZCxcbiAgICAgIGRyYWdOb2RlLFxuICAgICAgZHJhZ1gsXG4gICAgICBkcmFnWSxcbiAgICAgIGRyb3BSZXN1bHQsXG4gICAgICBkcm9wTm9kZVxuICAgIH07XG4gIH1cbn1cbiJdfQ==