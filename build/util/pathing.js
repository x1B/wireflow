define(['exports', 'module', './settings'], function (exports, module, _settings) {
  'use strict';

  function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { 'default': obj }; }

  var _settings2 = _interopRequireDefault(_settings);

  module.exports = {
    cubic: svgCubicBezierLinkPath,
    linear: svgLinearLinkPath
  };
  var X = 0;
  var Y = 1;
  var FROM = 0;
  var TO = 1;

  var DEFAULT_STUBS = [1, -1];

  // Length of a horizontal link stub that helps visualizing where a link is attached
  var baseStubLength = _settings2['default'].pathing.stubLength;
  var baseArrowHeadLength = _settings2['default'].pathing.arrowHeadLength;
  var baseCurvePadding = _settings2['default'].pathing.curvePadding;

  var round = Math.round;
  var abs = Math.abs;
  var min = Math.min;
  var max = Math.max;

  function svgLinearLinkPath(from, to, stubs, zoomFactor, boxes, showArrow) {
    var fromX = round(from[X]),
        fromY = round(from[Y]),
        toX = round(to[X]),
        toY = round(to[Y]),
        stubLength = baseStubLength * (zoomFactor || 1);

    var path = ['M', fromX, ',', fromY];
    path.push('H', fromX + stubs[FROM] * stubLength / 2);
    path.push('L', toX + stubs[TO] * stubLength / 2, ',', toY);
    path.push('H', toX);
    return path.join('');
  }

  ////////////////////////////////////////////////////////////////////////////////

  /*
   * Generate a smooth path between:
   *  - outbound port of a vertex and inbound port of another vertex
   *  - a port and an edge node
   *
   * Try to circumvent start and end box so that connections are obvious.
   */
  function svgCubicBezierLinkPath(from, to, zoomFactor, boxes, showArrow) {
    var stubs = arguments.length <= 5 || arguments[5] === undefined ? DEFAULT_STUBS : arguments[5];

    var arrowHeadLength = baseArrowHeadLength * (zoomFactor || 1);
    var stubLength = baseStubLength * (zoomFactor || 1);
    var safeDistanceX = 2 * stubLength;
    var safeDistanceY = 3 * stubLength;

    var distanceX = abs(from[X] - to[X]);
    var distanceY = abs(from[Y] - to[Y]);
    if (distanceX < safeDistanceX && distanceY < safeDistanceY) {
      return svgLinearLinkPath(from, to, stubs);
    }

    var params = initializeParameters(from, to, boxes, stubs, stubLength, baseCurvePadding);

    // Current path and position:
    var x = params.x0;
    var y = params.y0;

    var path = [];
    path.push('M', x, ',', y);
    var yDominates = startSegment();
    endSegment(yDominates);
    return path.join('');

    //////////////////////////////////////////////////////////////////////////////

    function startSegment() {
      if (params.reverse) {
        arrowHead();
      }
      horizontal(x + params.stub0 * stubLength);
      if (params.stub0 < 0) {
        return circumventBox0();
      }
      return false;
    }

    //////////////////////////////////////////////////////////////////////////////

    function endSegment(useBezierY) {
      if (params.stubN > 0 && params.boxN) {
        circumventBoxN(useBezierY);
      } else {
        cubic(params.xN + params.stubN * params.stubLength, params.yN);
      }

      horizontal(params.xN);
      if (!params.reverse) {
        arrowHead();
      }
    }

    //////////////////////////////////////////////////////////////////////////////

    function cubic(toX, toY) {
      var middleX = x + (toX - x) / 2;
      path.push('C', middleX, ',', y, ' ', middleX, ',', toY, ' ', toX, ',', toY);
      x = toX;
      y = toY;
    }

    //////////////////////////////////////////////////////////////////////////////

    function cubicY(toX, toY) {
      var middleY = y + (toY - y) / 2;
      path.push('C', x, ',', middleY, ' ', toX, ',', middleY, ' ', toX, ',', toY);
      x = toX;
      y = toY;
    }

    //////////////////////////////////////////////////////////////////////////////

    function horizontal(xAbs) {
      x = xAbs;
      path.push('H', x);
    }

    //////////////////////////////////////////////////////////////////////////////

    function arc90(xSgn, ySgn, sweep) {
      x += xSgn * params.curvePadding;
      y += ySgn * params.curvePadding;
      path.push('A', params.curvePadding, ',', params.curvePadding, ' 0 0,', sweep, ' ', x, ',', y);
    }

    //////////////////////////////////////////////////////////////////////////////

    function vertical(yAbs) {
      y = yAbs;
      path.push('V', yAbs);
    }

    //////////////////////////////////////////////////////////////////////////////

    function arrowHead() {
      if (!showArrow) {
        return;
      }

      var ax = x - stubLength - arrowHeadLength,
          ay = y;
      path.push('M', ax, ',', ay - arrowHeadLength, 'L', ax + stubLength / 2, ',', ay, 'L', ax, ',', ay + arrowHeadLength, 'L', ax + arrowHeadLength, ',', ay, 'L', ax, ',', ay - arrowHeadLength, 'M', x, ',', y);
    }

    //////////////////////////////////////////////////////////////////////////////

    function circumventBox0() {
      var xN = params.xN;
      var yN = params.yN;
      var box0 = params.box0;
      var boxN = params.boxN;
      var curvePadding = params.curvePadding;

      var yDir = calculateStartDirectionY();
      var sweep = yDir === 1 ? 0 : 1;

      circumventY();
      return circumventX();

      function circumventY() {
        // Arc and go to bottom/top:
        arc90(-1, yDir, sweep);
        if (yDir === 1) {
          vertical(max(box0.bottom, y + curvePadding));
        } else {
          vertical(min(box0.top, y - curvePadding));
        }
      }

      function circumventX() {
        // Cling to bottom/top edge as far as needed:
        if (yN * yDir < y * yDir || abs(y - yN) * 4 < abs(x - xN)) {
          arc90(1, yDir, sweep);
          if (yN * yDir < y * yDir) {
            horizontal(max(x, min(box0.right, xN - 2 * curvePadding)));
          }
          return false;
        }
        if (!boxN && xN > box0.left) {
          arc90(1, yDir, sweep);
          return false;
        }
        return true;
      }

      function calculateStartDirectionY() {
        // down: 1, up: -1
        if (!boxN && yN > y || boxN && boxN.top > box0.bottom) {
          // The entire dest is below this box: always go downwards
          return 1;
        }
        if (!boxN && yN < y || boxN && boxN.bottom < box0.top) {
          // The entire dest is above this box: always go upwards
          return -1;
        }
        // Shortest path to edge of this box
        return abs(box0.top - y) < abs(y - box0.bottom) ? -1 : 1;
      }
    }

    //////////////////////////////////////////////////////////////////////////////

    function circumventBoxN(useBezierY) {
      var boxN = params.boxN;
      var yN = params.yN;
      var curvePadding = params.curvePadding;

      // Draw line to nearest corner of boxN:
      var yDir, yEdge, xEdge, sweep;
      if (abs(boxN.top - y) + (y < yN ? -1 : 0) < abs(y - boxN.bottom)) {
        yDir = 1;
        yEdge = min(boxN.top - curvePadding, yN - 2 * curvePadding);
        sweep = 1;
        xEdge = yEdge > y ? boxN.right : boxN.left;
      } else {
        yDir = -1;
        yEdge = max(boxN.bottom + curvePadding, yN + 2 * curvePadding);
        sweep = 0;
        xEdge = yEdge < y ? boxN.right : boxN.left;
      }

      if (useBezierY) {
        cubicY(boxN.right + curvePadding, yEdge);
      } else {
        cubic(max(xEdge, x + curvePadding), yEdge);
        // Stick to bottom/top edge as far as needed:
        horizontal(boxN.right);
        arc90(1, yDir, sweep);
      }
      // turn towards port
      vertical(yN - yDir * curvePadding);
      arc90(-1, yDir, sweep);
    }
  }

  ////////////////////////////////////////////////////////////////////////////////

  function initializeParameters(from, to, boxes, stubs, stubLength, curvePadding) {
    var params = { stubLength: stubLength, curvePadding: curvePadding };

    var fromLeft = from[X],
        fromTop = from[Y];
    var toLeft = to[X],
        toTop = to[Y];
    var fromBox = boxes[FROM],
        toBox = boxes[TO];
    var fromStub = stubs[FROM],
        toStub = stubs[TO];

    var safeBoxDistance = 3 * stubLength;
    var minStubLength = 3;
    var minCurvePadding = 1;

    var yRatio = 1;
    if (toBox) {
      var boxDeltaY = abs(toTop > fromTop ? fromBox.bottom - toBox.top : toBox.bottom - fromBox.top);
      if (boxDeltaY < safeBoxDistance) {
        yRatio = boxDeltaY / safeBoxDistance;
        params.curvePadding = max(minStubLength, max(1, round(yRatio * curvePadding)));
      }
    }

    var deltaX = abs(fromLeft - toLeft);
    if (deltaX < safeBoxDistance && yRatio < 1) {
      var xRatio = deltaX / safeBoxDistance;
      params.stubLength = max(minStubLength, round(xRatio * stubLength));
      params.curvePadding = max(minCurvePadding, round(xRatio * curvePadding));
    }

    // Simplify by always drawing a path from left to right:
    params.reverse = fromLeft + fromStub * stubLength > toLeft + toStub * stubLength;
    if (params.reverse) {
      params.x0 = round(toLeft);
      params.xN = round(fromLeft);
      params.y0 = round(toTop);
      params.yN = round(fromTop);
      params.stub0 = toStub;
      params.stubN = fromStub;
      params.box0 = toBox;
      params.boxN = fromBox;
    } else {
      params.x0 = round(fromLeft);
      params.xN = round(toLeft);
      params.y0 = round(fromTop);
      params.yN = round(toTop);
      params.stub0 = fromStub;
      params.stubN = toStub;
      params.box0 = fromBox;
      params.boxN = toBox;
    }

    return params;
  }
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy91dGlsL3BhdGhpbmcuanN4Il0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7Ozs7bUJBRWU7QUFDYixTQUFLLEVBQUUsc0JBQXNCO0FBQzdCLFVBQU0sRUFBRSxpQkFBaUI7R0FDMUI7TUFFTyxDQUFDLEdBQVUsQ0FBQztNQUFULENBQUMsR0FBVSxDQUFDO01BQ2YsSUFBSSxHQUFXLENBQUM7TUFBVixFQUFFLEdBQVUsQ0FBQzs7QUFDM0IsTUFBTSxhQUFhLEdBQUcsQ0FBRSxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUUsQ0FBQzs7O0FBR2hDLE1BQU0sY0FBYyxHQUFHLHNCQUFTLE9BQU8sQ0FBQyxVQUFVLENBQUM7QUFDbkQsTUFBTSxtQkFBbUIsR0FBRyxzQkFBUyxPQUFPLENBQUMsZUFBZSxDQUFDO0FBQzdELE1BQU0sZ0JBQWdCLEdBQUcsc0JBQVMsT0FBTyxDQUFDLFlBQVksQ0FBQzs7TUFFL0MsS0FBSyxHQUFvQixJQUFJLENBQTdCLEtBQUs7TUFBRSxHQUFHLEdBQWUsSUFBSSxDQUF0QixHQUFHO01BQUUsR0FBRyxHQUFVLElBQUksQ0FBakIsR0FBRztNQUFFLEdBQUcsR0FBSyxJQUFJLENBQVosR0FBRzs7QUFHNUIsV0FBUyxpQkFBaUIsQ0FBRSxJQUFJLEVBQUUsRUFBRSxFQUFFLEtBQUssRUFBRSxVQUFVLEVBQUUsS0FBSyxFQUFFLFNBQVMsRUFBRztBQUMxRSxRQUFNLEtBQUssR0FBRyxLQUFLLENBQUUsSUFBSSxDQUFFLENBQUMsQ0FBRSxDQUFFO1FBQUUsS0FBSyxHQUFHLEtBQUssQ0FBRSxJQUFJLENBQUUsQ0FBQyxDQUFFLENBQUU7UUFDNUQsR0FBRyxHQUFHLEtBQUssQ0FBRSxFQUFFLENBQUUsQ0FBQyxDQUFFLENBQUU7UUFBRSxHQUFHLEdBQUcsS0FBSyxDQUFFLEVBQUUsQ0FBRSxDQUFDLENBQUUsQ0FBRTtRQUM5QyxVQUFVLEdBQUcsY0FBYyxJQUFLLFVBQVUsSUFBSSxDQUFDLENBQUEsQ0FBRzs7QUFFbEQs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LE9BQU8sQ0FBQztLQUN2QixNQUNJO0FBQ0gsWUFBTSxDQUFDLEVBQUUsR0FBRyxLQUFLLENBQUUsUUFBUSxDQUFFLENBQUM7QUFDOUIsWUFBTSxDQUFDLEVBQUUsR0FBRyxLQUFLLENBQUUsTUFBTSxDQUFFLENBQUM7QUFDNUIsWUFBTSxDQUFDLEVBQUUsR0FBRyxLQUFLLENBQUUsT0FBTyxDQUFFLENBQUM7QUFDN0IsWUFBTSxDQUFDLEVBQUUsR0FBRyxLQUFLLENBQUUsS0FBSyxDQUFFLENBQUM7QUFDM0IsWUFBTSxDQUFDLEtBQUssR0FBRyxRQUFRLENBQUM7QUFDeEIsWUFBTSxDQUFDLEtBQUssR0FBRyxNQUFNLENBQUM7QUFDdEIsWUFBTSxDQUFDLElBQUksR0FBRyxPQUFPLENBQUM7QUFDdEIsWUFBTSxDQUFDLElBQUksR0FBRyxLQUFLLENBQUM7S0FDckI7O0FBRUQsV0FBTyxNQUFNLENBQUM7R0FDZiIsImZpbGUiOiJwYXRoaW5nLmpzIiwic291cmNlUm9vdCI6InNyYyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBzZXR0aW5ncyBmcm9tICcuL3NldHRpbmdzJztcblxuZXhwb3J0IGRlZmF1bHQge1xuICBjdWJpYzogc3ZnQ3ViaWNCZXppZXJMaW5rUGF0aCxcbiAgbGluZWFyOiBzdmdMaW5lYXJMaW5rUGF0aFxufTtcblxuY29uc3QgWyBYLCBZIF0gPSBbIDAsIDEgXTtcbmNvbnN0IFsgRlJPTSwgVE8gXSA9IFsgMCwgMSBdO1xuY29uc3QgREVGQVVMVF9TVFVCUyA9IFsgMSwgLTEgXTtcblxuLy8gTGVuZ3RoIG9mIGEgaG9yaXpvbnRhbCBsaW5rIHN0dWIgdGhhdCBoZWxwcyB2aXN1YWxpemluZyB3aGVyZSBhIGxpbmsgaXMgYXR0YWNoZWRcbmNvbnN0IGJhc2VTdHViTGVuZ3RoID0gc2V0dGluZ3MucGF0aGluZy5zdHViTGVuZ3RoO1xuY29uc3QgYmFzZUFycm93SGVhZExlbmd0aCA9IHNldHRpbmdzLnBhdGhpbmcuYXJyb3dIZWFkTGVuZ3RoO1xuY29uc3QgYmFzZUN1cnZlUGFkZGluZyA9IHNldHRpbmdzLnBhdGhpbmcuY3VydmVQYWRkaW5nO1xuXG5jb25zdCB7IHJvdW5kLCBhYnMsIG1pbiwgbWF4IH0gPSBNYXRoO1xuXG5cbmZ1bmN0aW9uIHN2Z0xpbmVhckxpbmtQYXRoKCBmcm9tLCB0bywgc3R1YnMsIHpvb21GYWN0b3IsIGJveGVzLCBzaG93QXJyb3cgKSB7XG4gIGNvbnN0IGZyb21YID0gcm91bmQoIGZyb21bIFggXSApLCBmcm9tWSA9IHJvdW5kKCBmcm9tWyBZIF0gKSxcbiAgdG9YID0gcm91bmQoIHRvWyBYIF0gKSwgdG9ZID0gcm91bmQoIHRvWyBZIF0gKSxcbiAgc3R1Ykxlbmd0aCA9IGJhc2VTdHViTGVuZ3RoICogKCB6b29tRmFjdG9yIHx8IDEgKTtcblxuICBjb25zdCBwYXRoID0gWyAnTScsIGZyb21YLCAnLCcsIGZyb21ZIF07XG4gIHBhdGgucHVzaCggJ0gnLCBmcm9tWCArIHN0dWJzWyBGUk9NIF0gKiBzdHViTGVuZ3RoIC8gMiApO1xuICBwYXRoLnB1c2goICdMJywgdG9YICsgc3R1YnNbIFRPIF0gKiBzdHViTGVuZ3RoIC8gMiwgJywnLCB0b1kgKTtcbiAgcGF0aC5wdXNoKCAnSCcsIHRvWCApO1xuICByZXR1cm4gcGF0aC5qb2luKCAnJyApO1xufVxuXG4vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vL1xuXG4vKlxuICogR2VuZXJhdGUgYSBzbW9vdGggcGF0aCBiZXR3ZWVuOlxuICogIC0gb3V0Ym91bmQgcG9ydCBvZiBhIHZlcnRleCBhbmQgaW5ib3VuZCBwb3J0IG9mIGFub3RoZXIgdmVydGV4XG4gKiAgLSBhIHBvcnQgYW5kIGFuIGVkZ2Ugbm9kZVxuICpcbiAqIFRyeSB0byBjaXJjdW12ZW50IHN0YXJ0IGFuZCBlbmQgYm94IHNvIHRoYXQgY29ubmVjdGlvbnMgYXJlIG9idmlvdXMuXG4gKi9cbmZ1bmN0aW9uIHN2Z0N1YmljQmV6aWVyTGlua1BhdGgoXG4gIGZyb20sIHRvLCB6b29tRmFjdG9yLCBib3hlcywgc2hvd0Fycm93LCBzdHVicyA9IERFRkFVTFRfU1RVQlNcbikge1xuXG4gIGNvbnN0IGFycm93SGVhZExlbmd0aCA9IGJhc2VBcnJvd0hlYWRMZW5ndGggKiAoIHpvb21GYWN0b3IgfHwgMSApO1xuICBjb25zdCBzdHViTGVuZ3RoID0gYmFzZVN0dWJMZW5ndGggKiAoIHpvb21GYWN0b3IgfHwgMSApO1xuICBjb25zdCBzYWZlRGlzdGFuY2VYID0gMiAqIHN0dWJMZW5ndGg7XG4gIGNvbnN0IHNhZmVEaXN0YW5jZVkgPSAzICogc3R1Ykxlbmd0aDtcblxuICBjb25zdCBkaXN0YW5jZVggPSBhYnMoIGZyb21bIFggXSAtIHRvWyBYIF0gKTtcbiAgY29uc3QgZGlzdGFuY2VZID0gYWJzKCBmcm9tWyBZIF0gLSB0b1sgWSBdICk7XG4gIGlmKCBkaXN0YW5jZVggPCBzYWZlRGlzdGFuY2VYICYmIGRpc3RhbmNlWSA8IHNhZmVEaXN0YW5jZVkgKSB7XG4gICAgcmV0dXJuIHN2Z0xpbmVhckxpbmtQYXRoKCBmcm9tLCB0bywgc3R1YnMgKTtcbiAgfVxuXG4gIGNvbnN0IHBhcmFtcyA9IGluaXRpYWxpemVQYXJhbWV0ZXJzKFxuICAgIGZyb20sIHRvLCBib3hlcywgc3R1YnMsIHN0dWJMZW5ndGgsIGJhc2VDdXJ2ZVBhZGRpbmdcbiAgKTtcblxuICAvLyBDdXJyZW50IHBhdGggYW5kIHBvc2l0aW9uOlxuICB2YXIgWyB4LCB5IF0gPSBbIHBhcmFtcy54MCwgcGFyYW1zLnkwIF07XG5cbiAgY29uc3QgcGF0aCA9IFtdO1xuICBwYXRoLnB1c2goICdNJywgeCwgJywnLCB5ICk7XG4gIGNvbnN0IHlEb21pbmF0ZXMgPSBzdGFydFNlZ21lbnQoKTtcbiAgZW5kU2VnbWVudCggeURvbWluYXRlcyApO1xuICByZXR1cm4gcGF0aC5qb2luKCAnJyApO1xuXG4gIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vL1xuXG4gIGZ1bmN0aW9uIHN0YXJ0U2VnbWVudCgpIHtcbiAgICBpZiggcGFyYW1zLnJldmVyc2UgKSB7XG4gICAgICBhcnJvd0hlYWQoKTtcbiAgICB9XG4gICAgaG9yaXpvbnRhbCggeCArIHBhcmFtcy5zdHViMCAqIHN0dWJMZW5ndGggKTtcbiAgICBpZiggcGFyYW1zLnN0dWIwIDwgMCApIHtcbiAgICAgIHJldHVybiBjaXJjdW12ZW50Qm94MCgpO1xuICAgIH1cbiAgICByZXR1cm4gZmFsc2U7XG4gIH1cblxuICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy9cblxuICBmdW5jdGlvbiBlbmRTZWdtZW50KCB1c2VCZXppZXJZICkge1xuICAgIGlmKCBwYXJhbXMuc3R1Yk4gPiAwICYmIHBhcmFtcy5ib3hOICkge1xuICAgICAgY2lyY3VtdmVudEJveE4oIHVzZUJlemllclkgKTtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICBjdWJpYyggcGFyYW1zLnhOICsgcGFyYW1zLnN0dWJOICogcGFyYW1zLnN0dWJMZW5ndGgsIHBhcmFtcy55TiApO1xuICAgIH1cblxuICAgIGhvcml6b250YWwoIHBhcmFtcy54TiApO1xuICAgIGlmKCAhcGFyYW1zLnJldmVyc2UgKSB7XG4gICAgICBhcnJvd0hlYWQoKTtcbiAgICB9XG4gIH1cblxuICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy9cblxuICBmdW5jdGlvbiBjdWJpYyggdG9YLCB0b1kgKSB7XG4gICAgY29uc3QgbWlkZGxlWCA9IHggKyAodG9YIC0geCkgLyAyO1xuICAgIHBhdGgucHVzaCggJ0MnLCBtaWRkbGVYLCAnLCcsIHksICcgJywgbWlkZGxlWCwgJywnLCB0b1ksICcgJywgdG9YLCAnLCcsIHRvWSApO1xuICAgIHggPSB0b1g7XG4gICAgeSA9IHRvWTtcbiAgfVxuXG4gIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vL1xuXG4gIGZ1bmN0aW9uIGN1YmljWSggdG9YLCB0b1kgKSB7XG4gICAgY29uc3QgbWlkZGxlWSA9IHkgKyAodG9ZIC0geSkgLyAyO1xuICAgIHBhdGgucHVzaCggJ0MnLCB4LCAnLCcsIG1pZGRsZVksICcgJywgdG9YLCAnLCcsIG1pZGRsZVksICcgJywgdG9YLCAnLCcsIHRvWSApO1xuICAgIHggPSB0b1g7XG4gICAgeSA9IHRvWTtcbiAgfVxuXG4gIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vL1xuXG4gIGZ1bmN0aW9uIGhvcml6b250YWwoIHhBYnMgKSB7XG4gICAgeCA9IHhBYnM7XG4gICAgcGF0aC5wdXNoKCAnSCcsIHggKTtcbiAgfVxuXG4gIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vL1xuXG4gIGZ1bmN0aW9uIGFyYzkwKCB4U2duLCB5U2duLCBzd2VlcCApIHtcbiAgICB4ICs9IHhTZ24gKiBwYXJhbXMuY3VydmVQYWRkaW5nO1xuICAgIHkgKz0geVNnbiAqIHBhcmFtcy5jdXJ2ZVBhZGRpbmc7XG4gICAgcGF0aC5wdXNoKCAnQScsIHBhcmFtcy5jdXJ2ZVBhZGRpbmcsICcsJywgcGFyYW1zLmN1cnZlUGFkZGluZywgJyAwIDAsJywgc3dlZXAsICcgJywgeCwgJywnLCB5ICk7XG4gIH1cblxuICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy9cblxuICBmdW5jdGlvbiB2ZXJ0aWNhbCggeUFicyApIHtcbiAgICB5ID0geUFicztcbiAgICBwYXRoLnB1c2goICdWJywgeUFicyApO1xuICB9XG5cbiAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vXG5cbiAgZnVuY3Rpb24gYXJyb3dIZWFkKCkge1xuICAgIGlmKCAhc2hvd0Fycm93ICkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIGNvbnN0IGF4ID0geCAtIHN0dWJMZW5ndGggLSBhcnJvd0hlYWRMZW5ndGgsIGF5ID0geTtcbiAgICBwYXRoLnB1c2goXG4gICAgICAnTScsIGF4LCAnLCcsIGF5IC0gYXJyb3dIZWFkTGVuZ3RoLFxuICAgICAgJ0wnLCBheCArIHN0dWJMZW5ndGggLyAyLCAnLCcsIGF5LFxuICAgICAgJ0wnLCBheCwgJywnLCBheSArIGFycm93SGVhZExlbmd0aCxcbiAgICAgICdMJywgYXggKyBhcnJvd0hlYWRMZW5ndGgsICcsJywgYXksXG4gICAgICAnTCcsIGF4LCAnLCcsIGF5IC0gYXJyb3dIZWFkTGVuZ3RoLFxuICAgICAgJ00nLCB4LCAnLCcsIHlcbiAgICApO1xuICB9XG5cbiAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vXG5cbiAgZnVuY3Rpb24gY2lyY3VtdmVudEJveDAoKSB7XG4gICAgY29uc3QgeyB4TiwgeU4sIGJveDAsIGJveE4sIGN1cnZlUGFkZGluZyB9ID0gcGFyYW1zO1xuICAgIGNvbnN0IHlEaXIgPSBjYWxjdWxhdGVTdGFydERpcmVjdGlvblkoKTtcbiAgICBjb25zdCBzd2VlcCA9IHlEaXIgPT09IDEgPyAwIDogMTtcblxuICAgIGNpcmN1bXZlbnRZKCk7XG4gICAgcmV0dXJuIGNpcmN1bXZlbnRYKCk7XG5cbiAgICBmdW5jdGlvbiBjaXJjdW12ZW50WSgpIHtcbiAgICAgIC8vIEFyYyBhbmQgZ28gdG8gYm90dG9tL3RvcDpcbiAgICAgIGFyYzkwKCAtMSwgeURpciwgc3dlZXAgKTtcbiAgICAgIGlmKCB5RGlyID09PSAxICkge1xuICAgICAgICB2ZXJ0aWNhbCggbWF4KCBib3gwLmJvdHRvbSwgeSArIGN1cnZlUGFkZGluZyApICk7XG4gICAgICB9XG4gICAgICBlbHNlIHtcbiAgICAgICAgdmVydGljYWwoIG1pbiggYm94MC50b3AsIHkgLSBjdXJ2ZVBhZGRpbmcgKSApO1xuICAgICAgfVxuICAgIH1cblxuICAgIGZ1bmN0aW9uIGNpcmN1bXZlbnRYKCkge1xuICAgICAgLy8gQ2xpbmcgdG8gYm90dG9tL3RvcCBlZGdlIGFzIGZhciBhcyBuZWVkZWQ6XG4gICAgICBpZiggeU4gKiB5RGlyIDwgeSAqIHlEaXIgfHwgYWJzKCB5IC0geU4gKSAqIDQgPCBhYnMoIHggLSB4TiApICkge1xuICAgICAgICBhcmM5MCggMSwgeURpciwgc3dlZXAgKTtcbiAgICAgICAgaWYoIHlOICogeURpciA8IHkgKiB5RGlyICkge1xuICAgICAgICAgIGhvcml6b250YWwoIG1heCggeCwgbWluKCBib3gwLnJpZ2h0LCB4TiAtIDIgKiBjdXJ2ZVBhZGRpbmcgKSApICk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgfVxuICAgICAgaWYoICFib3hOICYmIHhOID4gYm94MC5sZWZ0ICkge1xuICAgICAgICBhcmM5MCggMSwgeURpciwgc3dlZXAgKTtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgfVxuICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gY2FsY3VsYXRlU3RhcnREaXJlY3Rpb25ZKCkge1xuICAgICAgLy8gZG93bjogMSwgdXA6IC0xXG4gICAgICBpZiggKCFib3hOICYmIHlOID4geSkgfHwgKGJveE4gJiYgYm94Ti50b3AgPiBib3gwLmJvdHRvbSkgKSB7XG4gICAgICAgIC8vIFRoZSBlbnRpcmUgZGVzdCBpcyBiZWxvdyB0aGlzIGJveDogYWx3YXlzIGdvIGRvd253YXJkc1xuICAgICAgICByZXR1cm4gMTtcbiAgICAgIH1cbiAgICAgIGlmKCAoIWJveE4gJiYgeU4gPCB5KSB8fCAoYm94TiAmJiBib3hOLmJvdHRvbSA8IGJveDAudG9wKSApIHtcbiAgICAgICAgLy8gVGhlIGVudGlyZSBkZXN0IGlzIGFib3ZlIHRoaXMgYm94OiBhbHdheXMgZ28gdXB3YXJkc1xuICAgICAgICByZXR1cm4gLTE7XG4gICAgICB9XG4gICAgICAvLyBTaG9ydGVzdCBwYXRoIHRvIGVkZ2Ugb2YgdGhpcyBib3hcbiAgICAgIHJldHVybiBhYnMoIGJveDAudG9wIC0geSApIDwgYWJzKCB5IC0gYm94MC5ib3R0b20gKSA/IC0xIDogMTtcbiAgICB9XG4gIH1cblxuICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy9cblxuICBmdW5jdGlvbiBjaXJjdW12ZW50Qm94TiggdXNlQmV6aWVyWSApIHtcbiAgICBjb25zdCB7IGJveE4sIHlOLCBjdXJ2ZVBhZGRpbmcgfSA9IHBhcmFtcztcblxuICAgIC8vIERyYXcgbGluZSB0byBuZWFyZXN0IGNvcm5lciBvZiBib3hOOlxuICAgIHZhciB5RGlyLCB5RWRnZSwgeEVkZ2UsIHN3ZWVwO1xuICAgIGlmKCBhYnMoIGJveE4udG9wIC0geSApICsgKHkgPCB5TiA/IC0xIDogMCkgPCBhYnMoIHkgLSBib3hOLmJvdHRvbSApICkge1xuICAgICAgeURpciA9IDE7XG4gICAgICB5RWRnZSA9IG1pbiggYm94Ti50b3AgLSBjdXJ2ZVBhZGRpbmcsIHlOIC0gMiAqIGN1cnZlUGFkZGluZyApO1xuICAgICAgc3dlZXAgPSAxO1xuICAgICAgeEVkZ2UgPSB5RWRnZSA+IHkgPyBib3hOLnJpZ2h0IDogYm94Ti5sZWZ0O1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgIHlEaXIgPSAtMTtcbiAgICAgIHlFZGdlID0gbWF4KCBib3hOLmJvdHRvbSArIGN1cnZlUGFkZGluZywgeU4gKyAyICogY3VydmVQYWRkaW5nICk7XG4gICAgICBzd2VlcCA9IDA7XG4gICAgICB4RWRnZSA9IHlFZGdlIDwgeSA/IGJveE4ucmlnaHQgOiBib3hOLmxlZnQ7XG4gICAgfVxuXG4gICAgaWYoIHVzZUJlemllclkgKSB7XG4gICAgICBjdWJpY1koIGJveE4ucmlnaHQgKyBjdXJ2ZVBhZGRpbmcsIHlFZGdlICk7XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgY3ViaWMoIG1heCggeEVkZ2UsIHggKyBjdXJ2ZVBhZGRpbmcgKSwgeUVkZ2UgKTtcbiAgICAgIC8vIFN0aWNrIHRvIGJvdHRvbS90b3AgZWRnZSBhcyBmYXIgYXMgbmVlZGVkOlxuICAgICAgaG9yaXpvbnRhbCggYm94Ti5yaWdodCApO1xuICAgICAgYXJjOTAoIDEsIHlEaXIsIHN3ZWVwICk7XG4gICAgfVxuICAgIC8vIHR1cm4gdG93YXJkcyBwb3J0XG4gICAgdmVydGljYWwoIHlOIC0geURpciAqIGN1cnZlUGFkZGluZyApO1xuICAgIGFyYzkwKCAtMSwgeURpciwgc3dlZXAgKTtcbiAgfVxuXG59XG5cbi8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vXG5cbmZ1bmN0aW9uIGluaXRpYWxpemVQYXJhbWV0ZXJzKCBmcm9tLCB0bywgYm94ZXMsIHN0dWJzLCBzdHViTGVuZ3RoLCBjdXJ2ZVBhZGRpbmcgKSB7XG4gIGNvbnN0IHBhcmFtcyA9IHsgc3R1Ykxlbmd0aDogc3R1Ykxlbmd0aCwgY3VydmVQYWRkaW5nOiBjdXJ2ZVBhZGRpbmcgfTtcblxuICBjb25zdCBmcm9tTGVmdCA9IGZyb21bIFggXSwgZnJvbVRvcCA9IGZyb21bIFkgXTtcbiAgY29uc3QgdG9MZWZ0ID0gdG9bIFggXSwgdG9Ub3AgPSB0b1sgWSBdO1xuICBjb25zdCBmcm9tQm94ID0gYm94ZXNbIEZST00gXSwgdG9Cb3ggPSBib3hlc1sgVE8gXTtcbiAgY29uc3QgZnJvbVN0dWIgPSBzdHVic1sgRlJPTSBdLCB0b1N0dWIgPSBzdHVic1sgVE8gXTtcblxuICBjb25zdCBzYWZlQm94RGlzdGFuY2UgPSAzICogc3R1Ykxlbmd0aDtcbiAgY29uc3QgbWluU3R1Ykxlbmd0aCA9IDM7XG4gIGNvbnN0IG1pbkN1cnZlUGFkZGluZyA9IDE7XG5cbiAgdmFyIHlSYXRpbyA9IDE7XG4gIGlmKCB0b0JveCApIHtcbiAgICB2YXIgYm94RGVsdGFZID0gYWJzKCB0b1RvcCA+IGZyb21Ub3AgP1xuICAgICAgZnJvbUJveC5ib3R0b20gLSB0b0JveC50b3AgOlxuICAgICAgdG9Cb3guYm90dG9tIC0gZnJvbUJveC50b3AgKTtcbiAgICBpZiggYm94RGVsdGFZIDwgc2FmZUJveERpc3RhbmNlICkge1xuICAgICAgeVJhdGlvID0gYm94RGVsdGFZIC8gc2FmZUJveERpc3RhbmNlO1xuICAgICAgcGFyYW1zLmN1cnZlUGFkZGluZyA9IG1heCggbWluU3R1Ykxlbmd0aCwgbWF4KCAxLCByb3VuZCggeVJhdGlvICogY3VydmVQYWRkaW5nICkgKSApO1xuICAgIH1cbiAgfVxuXG4gIHZhciBkZWx0YVggPSBhYnMoIGZyb21MZWZ0IC0gdG9MZWZ0ICk7XG4gIGlmKCBkZWx0YVggPCBzYWZlQm94RGlzdGFuY2UgJiYgeVJhdGlvIDwgMSApIHtcbiAgICB2YXIgeFJhdGlvID0gZGVsdGFYIC8gc2FmZUJveERpc3RhbmNlO1xuICAgIHBhcmFtcy5zdHViTGVuZ3RoID0gbWF4KCBtaW5TdHViTGVuZ3RoLCByb3VuZCggeFJhdGlvICogc3R1Ykxlbmd0aCApICk7XG4gICAgcGFyYW1zLmN1cnZlUGFkZGluZyA9IG1heCggbWluQ3VydmVQYWRkaW5nLCByb3VuZCggeFJhdGlvICogY3VydmVQYWRkaW5nICkgKTtcbiAgfVxuXG4gIC8vIFNpbXBsaWZ5IGJ5IGFsd2F5cyBkcmF3aW5nIGEgcGF0aCBmcm9tIGxlZnQgdG8gcmlnaHQ6XG4gIHBhcmFtcy5yZXZlcnNlID1cbiAgICBmcm9tTGVmdCArIGZyb21TdHViICogc3R1Ykxlbmd0aCA+XG4gICAgdG9MZWZ0ICsgdG9TdHViICogc3R1Ykxlbmd0aDtcbiAgaWYoIHBhcmFtcy5yZXZlcnNlICkge1xuICAgIHBhcmFtcy54MCA9IHJvdW5kKCB0b0xlZnQgKTtcbiAgICBwYXJhbXMueE4gPSByb3VuZCggZnJvbUxlZnQgKTtcbiAgICBwYXJhbXMueTAgPSByb3VuZCggdG9Ub3AgKTtcbiAgICBwYXJhbXMueU4gPSByb3VuZCggZnJvbVRvcCApO1xuICAgIHBhcmFtcy5zdHViMCA9IHRvU3R1YjtcbiAgICBwYXJhbXMuc3R1Yk4gPSBmcm9tU3R1YjtcbiAgICBwYXJhbXMuYm94MCA9IHRvQm94O1xuICAgIHBhcmFtcy5ib3hOID0gZnJvbUJveDtcbiAgfVxuICBlbHNlIHtcbiAgICBwYXJhbXMueDAgPSByb3VuZCggZnJvbUxlZnQgKTtcbiAgICBwYXJhbXMueE4gPSByb3VuZCggdG9MZWZ0ICk7XG4gICAgcGFyYW1zLnkwID0gcm91bmQoIGZyb21Ub3AgKTtcbiAgICBwYXJhbXMueU4gPSByb3VuZCggdG9Ub3AgKTtcbiAgICBwYXJhbXMuc3R1YjAgPSBmcm9tU3R1YjtcbiAgICBwYXJhbXMuc3R1Yk4gPSB0b1N0dWI7XG4gICAgcGFyYW1zLmJveDAgPSBmcm9tQm94O1xuICAgIHBhcmFtcy5ib3hOID0gdG9Cb3g7XG4gIH1cblxuICByZXR1cm4gcGFyYW1zO1xufVxuIl19