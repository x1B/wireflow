define(['exports', 'module', '../history-store', '../history-actions', '../../testing/dispatcher-mock'], function (exports, module, _historyStore, _historyActions, _testingDispatcherMock) {
  'use strict';

  function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { 'default': obj }; }

  var _HistoryStore = _interopRequireDefault(_historyStore);

  var _DispatcherMock = _interopRequireDefault(_testingDispatcherMock);

  // Jasmine:
  var jasmine = window.jasmine;
  var describe = window.describe;
  var beforeEach = window.beforeEach;
  var expect = window.expect;
  var it = window.it;
  var any = jasmine.any;

  describe('A history store', function () {

    var dispatcher;
    var store;

    beforeEach(function () {
      dispatcher = new _DispatcherMock['default']();
      store = new _HistoryStore['default'](dispatcher);
    });

    it('handles history actions', function () {
      expect(dispatcher.register).toHaveBeenCalledWith(_historyActions.SaveState, any(Function));
      expect(dispatcher.register).toHaveBeenCalledWith(_historyActions.CreateCheckpoint, any(Function));
      expect(dispatcher.register).toHaveBeenCalledWith(_historyActions.UiUndo, any(Function));
      expect(dispatcher.register).toHaveBeenCalledWith(_historyActions.UiRedo, any(Function));
    });

    it('begins with an empty log', function () {
      expect(store.checkpoints.toJS()).toEqual([]);
      expect(store.now).toEqual(0);
      expect(store.storeLogs.toJS()).toEqual({});
    });

    describe('asked to create a checkpoint,', function () {
      beforeEach(function () {
        dispatcher.handleAction((0, _historyActions.CreateCheckpoint)({ before: 'set.to.A1' }));
      });

      it('inserts a checkpoint', function () {
        expect(store.checkpoints.toJS()).toEqual([{ at: 1, before: 'set.to.A1' }]);
        expect(store.now).toEqual(2);
        expect(store.storeLogs.toJS()).toEqual({});
      });

      describe('then asked to save state,', function () {

        beforeEach(function () {
          dispatcher.handleAction((0, _historyActions.SaveState)({ storeId: 'A', state: 'A1' }));
        });

        it('saves state to the log', function () {
          expect(store.storeLogs.toJS()).toEqual({
            A: [{ at: 2, state: 'A1' }]
          });
        });
      });
    });

    describe('asked to save state,', function () {

      beforeEach(function () {
        dispatcher.handleAction((0, _historyActions.SaveState)({ storeId: 'A', state: 'A1' }));
        dispatcher.handleAction((0, _historyActions.SaveState)({ storeId: 'B', state: 'B1' }));
      });

      it('saves state to the log', function () {
        expect(store.storeLogs.toJS()).toEqual({
          A: [{ at: 0, state: 'A1' }],
          B: [{ at: 0, state: 'B1' }]
        });
      });

      describe('then to create a checkpoint,', function () {
        beforeEach(function () {
          dispatcher.handleAction((0, _historyActions.CreateCheckpoint)({ before: 'set.to.A2' }));
        });

        it('inserts a checkpoint', function () {
          expect(store.checkpoints.toJS()).toEqual([{ at: 1, before: 'set.to.A2' }]);
          expect(store.now).toEqual(2);
        });

        it('keeps store log contents', function () {
          expect(store.storeLogs.toJS()).toEqual({
            A: [{ at: 0, state: 'A1' }],
            B: [{ at: 0, state: 'B1' }]
          });
        });

        describe('and then to save more state,', function () {
          beforeEach(function () {
            dispatcher.handleAction((0, _historyActions.SaveState)({ storeId: 'A', state: 'A2' }));
            dispatcher.handleAction((0, _historyActions.SaveState)({ storeId: 'B', state: 'B1' }));
          });

          it('appends new state to the store log', function () {
            expect(store.storeLogs.get('A').toJS()).toEqual([{ at: 0, state: 'A1' }, { at: 2, state: 'A2' }]);
          });

          it('does not touch the store log where contents remain the same', function () {
            expect(store.storeLogs.get('B').toJS()).toEqual([{ at: 0, state: 'B1' }]);
          });

          describe('then to undo,', function () {

            beforeEach(function () {
              dispatcher.dispatch.calls.reset();
              dispatcher.handleAction((0, _historyActions.UiUndo)());
            });

            it('restores the previous state from the store log', function () {
              expect(dispatcher.dispatch).toHaveBeenCalledWith((0, _historyActions.RestoreState)({ storeId: 'A', state: 'A1' }));
            });

            it('does not restore state if untouched since checkpoint', function () {
              expect(dispatcher.dispatch).not.toHaveBeenCalledWith((0, _historyActions.RestoreState)({ storeId: 'B', state: 'B1' }));
            });

            it('does not remove store log entries', function () {
              expect(store.storeLogs.toJS()).toEqual({
                A: [{ at: 0, state: 'A1' }, { at: 2, state: 'A2' }],
                B: [{ at: 0, state: 'B1' }]
              });
            });

            describe('and then to redo,', function () {
              beforeEach(function () {
                dispatcher.dispatch.calls.reset();
                dispatcher.handleAction((0, _historyActions.UiRedo)());
              });

              it('restores the more recent state from the store log', function () {
                var restore = dispatcher.dispatch.calls.mostRecent().args[0];
                expect(restore.toJS()).toEqual({ storeId: 'A', state: 'A2', type: (0, _historyActions.RestoreState)().type });
              });

              it('does not remove store log entries', function () {
                expect(store.storeLogs.toJS()).toEqual({
                  A: [{ at: 0, state: 'A1' }, { at: 2, state: 'A2' }],
                  B: [{ at: 0, state: 'B1' }]
                });
              });
            });

            describe('and then to create a new checkpoint,', function () {
              beforeEach(function () {
                return dispatcher.handleAction((0, _historyActions.CreateCheckpoint)({ before: 'set.to.A2x' }));
              });

              it('discards any rewound states from the store log', function () {
                expect(store.storeLogs.toJS()).toEqual({
                  A: [{ at: 0, state: 'A1' }],
                  B: [{ at: 0, state: 'B1' }]
                });
              });

              it('replaces any rewound checkpoints with the new one', function () {
                expect(store.checkpoints.toJS()).toEqual([{ at: 1, before: 'set.to.A2x' }]);
              });
            });
          });
        });
      });

      describe('then asked to undo without a checkpoint,', function () {
        beforeEach(function () {
          dispatcher.handleAction((0, _historyActions.UiUndo)());
        });

        it('does nothing', function () {
          expect(store.checkpoints.toJS()).toEqual([]);
          expect(store.now).toEqual(0);
          expect(store.storeLogs.toJS()).toEqual({
            A: [{ at: 0, state: 'A1' }],
            B: [{ at: 0, state: 'B1' }]
          });
        });
      });

      describe('and to save more state before the next checkpoint,', function () {
        beforeEach(function () {
          dispatcher.handleAction((0, _historyActions.SaveState)({ storeId: 'A', state: 'A2' }));
          dispatcher.handleAction((0, _historyActions.SaveState)({ storeId: 'B', state: 'B2' }));
          dispatcher.handleAction((0, _historyActions.SaveState)({ storeId: 'B', state: 'B3' }));
        });

        it('replaces the previous state', function () {
          expect(store.storeLogs.toJS()).toEqual({
            A: [{ at: 0, state: 'A2' }],
            B: [{ at: 0, state: 'B3' }]
          });
        });
      });
    });
  });

  module.exports = {};
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL3NyYy9mbHV4L2hpc3Rvcnkvc3BlYy9oaXN0b3J5LXN0b3JlLnNwZWMuanN4Il0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7TUFTUSxPQUFPLEdBQXVDLE1BQU0sQ0FBcEQsT0FBTztNQUFFLFFBQVEsR0FBNkIsTUFBTSxDQUEzQyxRQUFRO01BQUUsVUFBVSxHQUFpQixNQUFNLENBQWpDLFVBQVU7TUFBRSxNQUFNLEdBQVMsTUFBTSxDQUFyQixNQUFNO01BQUUsRUFBRSxHQUFLLE1BQU0sQ0FBYixFQUFFO01BQ3pDLEdBQUcsR0FBSyxPQUFPLENBQWYsR0FBRzs7QUFFWCxVQUFRLENBQUUsaUJBQWlCLEVBQUUsWUFBTTs7QUFFakMsUUFBSSxVQUFVLENBQUM7QUFDZixRQUFJLEtBQUssQ0FBQzs7QUFFVixjQUFVLENBQUUsWUFBTTtBQUNoQixnQkFBVSxHQUFHLGdDQUFvQixDQUFDO0FBQ2xDLFdBQUssR0FBRyw2QkFBa0IsVUFBVSxDQUFFLENBQUM7S0FDeEMsQ0FBRSxDQUFDOztBQUdKLE1BQUUsQ0FBRSx5QkFBeUIsRUFBRSxZQUFNO0FBQ25DLFlBQU0sQ0FBRSxVQUFVLENBQUMsUUFBUSxDQUFFLENBQzFCLG9CQUFvQixpQkF2QlAsU0FBUyxFQXVCVyxHQUFHLENBQUUsUUFBUSxDQUFFLENBQUUsQ0FBQztBQUN0RCxZQUFNLENBQUUsVUFBVSxDQUFDLFFBQVEsQ0FBRSxDQUMxQixvQkFBb0IsaUJBekJ6QixnQkFBZ0IsRUF5QjZCLEdBQUcsQ0FBRSxRQUFRLENBQUUsQ0FBRSxDQUFDO0FBQzdELFlBQU0sQ0FBRSxVQUFVLENBQUMsUUFBUSxDQUFFLENBQzFCLG9CQUFvQixpQkEzQmtCLE1BQU0sRUEyQmQsR0FBRyxDQUFFLFFBQVEsQ0FBRSxDQUFFLENBQUM7QUFDbkQsWUFBTSxDQUFFLFVBQVUsQ0FBQyxRQUFRLENBQUUsQ0FDMUIsb0JBQW9CLGlCQTdCMEIsTUFBTSxFQTZCdEIsR0FBRyxDQUFFLFFBQVEsQ0FB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Q0FBRSxvQkF6TmIsU0FBUyxFQXlOYyxFQUFFLE9BQU8sRUFBRSxHQUFHLEVBQUUsS0FBSyxFQUFFLElBQUksRUFBRSxDQUFDLENBQUUsQ0FBQztBQUNwRSxvQkFBVSxDQUFDLFlBQVksQ0FBRSxvQkExTmIsU0FBUyxFQTBOYyxFQUFFLE9BQU8sRUFBRSxHQUFHLEVBQUUsS0FBSyxFQUFFLElBQUksRUFBRSxDQUFDLENBQUUsQ0FBQztTQUNyRSxDQUFFLENBQUM7O0FBRUosVUFBRSxDQUFFLDZCQUE2QixFQUFFLFlBQU07QUFDdkMsZ0JBQU0sQ0FBRSxLQUFLLENBQUMsU0FBUyxDQUFDLElBQUksRUFBRSxDQUFFLENBQUMsT0FBTyxDQUFDO0FBQ3ZDLGFBQUMsRUFBRSxDQUFFLEVBQUUsRUFBRSxFQUFFLENBQUMsRUFBRSxLQUFLLEVBQUUsSUFBSSxFQUFFLENBQUU7QUFDN0IsYUFBQyxFQUFFLENBQUUsRUFBRSxFQUFFLEVBQUUsQ0FBQyxFQUFFLEtBQUssRUFBRSxJQUFJLEVBQUUsQ0FBRTtXQUM5QixDQUFDLENBQUM7U0FDSixDQUFFLENBQUM7T0FDTCxDQUFFLENBQUM7S0FFTCxDQUFFLENBQUM7R0FFTCxDQUFFLENBQUM7O21CQUVXLEVBQUUiLCJmaWxlIjoiaGlzdG9yeS1zdG9yZS5zcGVjLmpzIiwic291cmNlUm9vdCI6InNyYyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBIaXN0b3J5U3RvcmUgZnJvbSAnLi4vaGlzdG9yeS1zdG9yZSc7XG5pbXBvcnQge1xuICBDcmVhdGVDaGVja3BvaW50LCBTYXZlU3RhdGUsIFJlc3RvcmVTdGF0ZSwgVWlVbmRvLCBVaVJlZG9cbn0gZnJvbSAnLi4vaGlzdG9yeS1hY3Rpb25zJztcblxuaW1wb3J0IERpc3BhdGNoZXJNb2NrIGZyb20gJy4uLy4uL3Rlc3RpbmcvZGlzcGF0Y2hlci1tb2NrJztcblxuXG4vLyBKYXNtaW5lOlxuY29uc3QgeyBqYXNtaW5lLCBkZXNjcmliZSwgYmVmb3JlRWFjaCwgZXhwZWN0LCBpdCB9ID0gd2luZG93O1xuY29uc3QgeyBhbnkgfSA9IGphc21pbmU7XG5cbmRlc2NyaWJlKCAnQSBoaXN0b3J5IHN0b3JlJywgKCkgPT4ge1xuXG4gIHZhciBkaXNwYXRjaGVyO1xuICB2YXIgc3RvcmU7XG5cbiAgYmVmb3JlRWFjaCggKCkgPT4ge1xuICAgIGRpc3BhdGNoZXIgPSBuZXcgRGlzcGF0Y2hlck1vY2soKTtcbiAgICBzdG9yZSA9IG5ldyBIaXN0b3J5U3RvcmUoIGRpc3BhdGNoZXIgKTtcbiAgfSApO1xuXG5cbiAgaXQoICdoYW5kbGVzIGhpc3RvcnkgYWN0aW9ucycsICgpID0+IHtcbiAgICBleHBlY3QoIGRpc3BhdGNoZXIucmVnaXN0ZXIgKVxuICAgICAgLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKCBTYXZlU3RhdGUsIGFueSggRnVuY3Rpb24gKSApO1xuICAgIGV4cGVjdCggZGlzcGF0Y2hlci5yZWdpc3RlciApXG4gICAgICAudG9IYXZlQmVlbkNhbGxlZFdpdGgoIENyZWF0ZUNoZWNrcG9pbnQsIGFueSggRnVuY3Rpb24gKSApO1xuICAgIGV4cGVjdCggZGlzcGF0Y2hlci5yZWdpc3RlciApXG4gICAgICAudG9IYXZlQmVlbkNhbGxlZFdpdGgoIFVpVW5kbywgYW55KCBGdW5jdGlvbiApICk7XG4gICAgZXhwZWN0KCBkaXNwYXRjaGVyLnJlZ2lzdGVyIClcbiAgICAgIC50b0hhdmVCZWVuQ2FsbGVkV2l0aCggVWlSZWRvLCBhbnkoIEZ1bmN0aW9uICkgKTtcbiAgfSApO1xuXG5cbiAgaXQoICdiZWdpbnMgd2l0aCBhbiBlbXB0eSBsb2cnLCAoKSA9PiB7XG4gICAgZXhwZWN0KCBzdG9yZS5jaGVja3BvaW50cy50b0pTKCkgKS50b0VxdWFsKCBbXSApO1xuICAgIGV4cGVjdCggc3RvcmUubm93ICkudG9FcXVhbCggMCApO1xuICAgIGV4cGVjdCggc3RvcmUuc3RvcmVMb2dzLnRvSlMoKSApLnRvRXF1YWwoIHt9ICk7XG4gIH0gKTtcblxuXG4gIGRlc2NyaWJlKCAnYXNrZWQgdG8gY3JlYXRlIGEgY2hlY2twb2ludCwnLCAoKSA9PiB7XG4gICAgYmVmb3JlRWFjaCggKCkgPT4ge1xuICAgICAgZGlzcGF0Y2hlci5oYW5kbGVBY3Rpb24oIENyZWF0ZUNoZWNrcG9pbnQoeyBiZWZvcmU6ICdzZXQudG8uQTEnIH0pICk7XG4gICAgfSApO1xuXG4gICAgaXQoICdpbnNlcnRzIGEgY2hlY2twb2ludCcsICgpID0+IHtcbiAgICAgIGV4cGVjdCggc3RvcmUuY2hlY2twb2ludHMudG9KUygpICkudG9FcXVhbChbXG4gICAgICAgIHsgYXQ6IDEsIGJlZm9yZTogJ3NldC50by5BMScgfVxuICAgICAgXSk7XG4gICAgICBleHBlY3QoIHN0b3JlLm5vdyApLnRvRXF1YWwoIDIgKTtcbiAgICAgIGV4cGVjdCggc3RvcmUuc3RvcmVMb2dzLnRvSlMoKSApLnRvRXF1YWwoIHt9ICk7XG4gICAgfSApO1xuXG5cbiAgICBkZXNjcmliZSggJ3RoZW4gYXNrZWQgdG8gc2F2ZSBzdGF0ZSwnLCAoKSA9PiB7XG5cbiAgICAgIGJlZm9yZUVhY2goICgpID0+IHtcbiAgICAgICAgZGlzcGF0Y2hlci5oYW5kbGVBY3Rpb24oIFNhdmVTdGF0ZSh7IHN0b3JlSWQ6ICdBJywgc3RhdGU6ICdBMScgfSkgKTtcbiAgICAgIH0gKTtcblxuICAgICAgaXQoICdzYXZlcyBzdGF0ZSB0byB0aGUgbG9nJywgKCkgPT4ge1xuICAgICAgICBleHBlY3QoIHN0b3JlLnN0b3JlTG9ncy50b0pTKCkgKS50b0VxdWFsKHtcbiAgICAgICAgICBBOiBbIHsgYXQ6IDIsIHN0YXRlOiAnQTEnIH0gXVxuICAgICAgICB9KTtcbiAgICAgIH0gKTtcblxuICAgIH0gKTtcblxuICB9ICk7XG5cblxuICBkZXNjcmliZSggJ2Fza2VkIHRvIHNhdmUgc3RhdGUsJywgKCkgPT4ge1xuXG4gICAgYmVmb3JlRWFjaCggKCkgPT4ge1xuICAgICAgZGlzcGF0Y2hlci5oYW5kbGVBY3Rpb24oIFNhdmVTdGF0ZSh7IHN0b3JlSWQ6ICdBJywgc3RhdGU6ICdBMScgfSkgKTtcbiAgICAgIGRpc3BhdGNoZXIuaGFuZGxlQWN0aW9uKCBTYXZlU3RhdGUoeyBzdG9yZUlkOiAnQicsIHN0YXRlOiAnQjEnIH0pICk7XG4gICAgfSApO1xuXG4gICAgaXQoICdzYXZlcyBzdGF0ZSB0byB0aGUgbG9nJywgKCkgPT4ge1xuICAgICAgZXhwZWN0KCBzdG9yZS5zdG9yZUxvZ3MudG9KUygpICkudG9FcXVhbCh7XG4gICAgICAgIEE6IFsgeyBhdDogMCwgc3RhdGU6ICdBMScgfSBdLFxuICAgICAgICBCOiBbIHsgYXQ6IDAsIHN0YXRlOiAnQjEnIH0gXVxuICAgICAgfSk7XG4gICAgfSApO1xuXG5cbiAgICBkZXNjcmliZSggJ3RoZW4gdG8gY3JlYXRlIGEgY2hlY2twb2ludCwnLCAoKSA9PiB7XG4gICAgICBiZWZvcmVFYWNoKCAoKSA9PiB7XG4gICAgICAgIGRpc3BhdGNoZXIuaGFuZGxlQWN0aW9uKCBDcmVhdGVDaGVja3BvaW50KHsgYmVmb3JlOiAnc2V0LnRvLkEyJyB9KSApO1xuICAgICAgfSApO1xuXG4gICAgICBpdCggJ2luc2VydHMgYSBjaGVja3BvaW50JywgKCkgPT4ge1xuICAgICAgICBleHBlY3QoIHN0b3JlLmNoZWNrcG9pbnRzLnRvSlMoKSApLnRvRXF1YWwoW1xuICAgICAgICAgIHsgYXQ6IDEsIGJlZm9yZTogJ3NldC50by5BMicgfVxuICAgICAgICBdKTtcbiAgICAgICAgZXhwZWN0KCBzdG9yZS5ub3cgKS50b0VxdWFsKCAyICk7XG4gICAgICB9KTtcblxuICAgICAgaXQoICdrZWVwcyBzdG9yZSBsb2cgY29udGVudHMnLCAoKSA9PiB7XG4gICAgICAgIGV4cGVjdCggc3RvcmUuc3RvcmVMb2dzLnRvSlMoKSApLnRvRXF1YWwoe1xuICAgICAgICAgIEE6IFsgeyBhdDogMCwgc3RhdGU6ICdBMScgfSBdLFxuICAgICAgICAgIEI6IFsgeyBhdDogMCwgc3RhdGU6ICdCMScgfSBdXG4gICAgICAgIH0pO1xuICAgICAgfSApO1xuXG5cbiAgICAgIGRlc2NyaWJlKCAnYW5kIHRoZW4gdG8gc2F2ZSBtb3JlIHN0YXRlLCcsICgpID0+IHtcbiAgICAgICAgYmVmb3JlRWFjaCggKCkgPT4ge1xuICAgICAgICAgIGRpc3BhdGNoZXIuaGFuZGxlQWN0aW9uKCBTYXZlU3RhdGUoeyBzdG9yZUlkOiAnQScsIHN0YXRlOiAnQTInIH0pICk7XG4gICAgICAgICAgZGlzcGF0Y2hlci5oYW5kbGVBY3Rpb24oIFNhdmVTdGF0ZSh7IHN0b3JlSWQ6ICdCJywgc3RhdGU6ICdCMScgfSkgKTtcbiAgICAgICAgfSApO1xuXG4gICAgICAgIGl0KCAnYXBwZW5kcyBuZXcgc3RhdGUgdG8gdGhlIHN0b3JlIGxvZycsICgpID0+IHtcbiAgICAgICAgICBleHBlY3QoIHN0b3JlLnN0b3JlTG9ncy5nZXQoICdBJyApLnRvSlMoKSApLnRvRXF1YWwoXG4gICAgICAgICAgICBbIHsgYXQ6IDAsIHN0YXRlOiAnQTEnIH0sIHsgYXQ6IDIsIHN0YXRlOiAnQTInIH0gXVxuICAgICAgICAgICk7XG4gICAgICAgIH0gKTtcblxuICAgICAgICBpdCggJ2RvZXMgbm90IHRvdWNoIHRoZSBzdG9yZSBsb2cgd2hlcmUgY29udGVudHMgcmVtYWluIHRoZSBzYW1lJywgKCkgPT4ge1xuICAgICAgICAgIGV4cGVjdCggc3RvcmUuc3RvcmVMb2dzLmdldCggJ0InICkudG9KUygpICkudG9FcXVhbChcbiAgICAgICAgICAgIFsgeyBhdDogMCwgc3RhdGU6ICdCMScgfSBdXG4gICAgICAgICAgKTtcbiAgICAgICAgfSApO1xuXG4gICAgICAgIGRlc2NyaWJlKCAndGhlbiB0byB1bmRvLCcsICgpID0+IHtcblxuICAgICAgICAgIGJlZm9yZUVhY2goICgpID0+IHtcbiAgICAgICAgICAgIGRpc3BhdGNoZXIuZGlzcGF0Y2guY2FsbHMucmVzZXQoKTtcbiAgICAgICAgICAgIGRpc3BhdGNoZXIuaGFuZGxlQWN0aW9uKCBVaVVuZG8oKSApO1xuICAgICAgICAgIH0gKTtcblxuICAgICAgICAgIGl0KCAncmVzdG9yZXMgdGhlIHByZXZpb3VzIHN0YXRlIGZyb20gdGhlIHN0b3JlIGxvZycsICgpID0+IHtcbiAgICAgICAgICAgIGV4cGVjdCggZGlzcGF0Y2hlci5kaXNwYXRjaCApLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKFxuICAgICAgICAgICAgICBSZXN0b3JlU3RhdGUoeyBzdG9yZUlkOiAnQScsIHN0YXRlOiAnQTEnIH0pXG4gICAgICAgICAgICApO1xuICAgICAgICAgIH0gKTtcblxuICAgICAgICAgIGl0KCAnZG9lcyBub3QgcmVzdG9yZSBzdGF0ZSBpZiB1bnRvdWNoZWQgc2luY2UgY2hlY2twb2ludCcsICgpID0+IHtcbiAgICAgICAgICAgIGV4cGVjdCggZGlzcGF0Y2hlci5kaXNwYXRjaCApLm5vdC50b0hhdmVCZWVuQ2FsbGVkV2l0aChcbiAgICAgICAgICAgICAgUmVzdG9yZVN0YXRlKHsgc3RvcmVJZDogJ0InLCBzdGF0ZTogJ0IxJyB9KVxuICAgICAgICAgICAgKTtcbiAgICAgICAgICB9ICk7XG5cbiAgICAgICAgICBpdCggJ2RvZXMgbm90IHJlbW92ZSBzdG9yZSBsb2cgZW50cmllcycsICgpID0+IHtcbiAgICAgICAgICAgIGV4cGVjdCggc3RvcmUuc3RvcmVMb2dzLnRvSlMoKSApLnRvRXF1YWwoe1xuICAgICAgICAgICAgICBBOiBbIHsgYXQ6IDAsIHN0YXRlOiAnQTEnIH0sIHsgYXQ6IDIsIHN0YXRlOiAnQTInIH0gXSxcbiAgICAgICAgICAgICAgQjogWyB7IGF0OiAwLCBzdGF0ZTogJ0IxJyB9IF1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgIH0gKTtcblxuICAgICAgICAgIGRlc2NyaWJlKCAnYW5kIHRoZW4gdG8gcmVkbywnLCAoKSA9PiB7XG4gICAgICAgICAgICBiZWZvcmVFYWNoKCAoKSA9PiB7XG4gICAgICAgICAgICAgIGRpc3BhdGNoZXIuZGlzcGF0Y2guY2FsbHMucmVzZXQoKTtcbiAgICAgICAgICAgICAgZGlzcGF0Y2hlci5oYW5kbGVBY3Rpb24oIFVpUmVkbygpICk7XG4gICAgICAgICAgICB9ICk7XG5cbiAgICAgICAgICAgIGl0KCAncmVzdG9yZXMgdGhlIG1vcmUgcmVjZW50IHN0YXRlIGZyb20gdGhlIHN0b3JlIGxvZycsICgpID0+IHtcbiAgICAgICAgICAgICAgY29uc3QgcmVzdG9yZSA9IGRpc3BhdGNoZXIuZGlzcGF0Y2guY2FsbHMubW9zdFJlY2VudCgpLmFyZ3NbIDAgXTtcbiAgICAgICAgICAgICAgZXhwZWN0KCByZXN0b3JlLnRvSlMoKSApLnRvRXF1YWwoXG4gICAgICAgICAgICAgICAgeyBzdG9yZUlkOiAnQScsIHN0YXRlOiAnQTInLCB0eXBlOiBSZXN0b3JlU3RhdGUoKS50eXBlIH1cbiAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgIH0gKTtcblxuICAgICAgICAgICAgaXQoICdkb2VzIG5vdCByZW1vdmUgc3RvcmUgbG9nIGVudHJpZXMnLCAoKSA9PiB7XG4gICAgICAgICAgICAgIGV4cGVjdCggc3RvcmUuc3RvcmVMb2dzLnRvSlMoKSApLnRvRXF1YWwoe1xuICAgICAgICAgICAgICAgIEE6IFsgeyBhdDogMCwgc3RhdGU6ICdBMScgfSwgeyBhdDogMiwgc3RhdGU6ICdBMicgfSBdLFxuICAgICAgICAgICAgICAgIEI6IFsgeyBhdDogMCwgc3RhdGU6ICdCMScgfSBdXG4gICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSApO1xuICAgICAgICAgIH0gKTtcblxuICAgICAgICAgIGRlc2NyaWJlKCAnYW5kIHRoZW4gdG8gY3JlYXRlIGEgbmV3IGNoZWNrcG9pbnQsJywgKCkgPT4ge1xuICAgICAgICAgICAgYmVmb3JlRWFjaCggKCkgPT4gZGlzcGF0Y2hlci5oYW5kbGVBY3Rpb24oXG4gICAgICAgICAgICAgIENyZWF0ZUNoZWNrcG9pbnQoeyBiZWZvcmU6ICdzZXQudG8uQTJ4JyB9KVxuICAgICAgICAgICAgKSApO1xuXG4gICAgICAgICAgICBpdCggJ2Rpc2NhcmRzIGFueSByZXdvdW5kIHN0YXRlcyBmcm9tIHRoZSBzdG9yZSBsb2cnLCAoKSA9PiB7XG4gICAgICAgICAgICAgIGV4cGVjdCggc3RvcmUuc3RvcmVMb2dzLnRvSlMoKSApLnRvRXF1YWwoe1xuICAgICAgICAgICAgICAgIEE6IFsgeyBhdDogMCwgc3RhdGU6ICdBMScgfSBdLFxuICAgICAgICAgICAgICAgIEI6IFsgeyBhdDogMCwgc3RhdGU6ICdCMScgfSBdXG4gICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSApO1xuXG4gICAgICAgICAgICBpdCggJ3JlcGxhY2VzIGFueSByZXdvdW5kIGNoZWNrcG9pbnRzIHdpdGggdGhlIG5ldyBvbmUnLCAoKSA9PiB7XG4gICAgICAgICAgICAgIGV4cGVjdCggc3RvcmUuY2hlY2twb2ludHMudG9KUygpICkudG9FcXVhbChbXG4gICAgICAgICAgICAgICAgeyBhdDogMSwgYmVmb3JlOiAnc2V0LnRvLkEyeCcgfVxuICAgICAgICAgICAgICBdKTtcbiAgICAgICAgICAgIH0gKTtcblxuICAgICAgICAgIH0gKTtcblxuICAgICAgICB9ICk7XG5cbiAgICAgIH0gKTtcblxuICAgIH0gKTtcblxuXG4gICAgZGVzY3JpYmUoICd0aGVuIGFza2VkIHRvIHVuZG8gd2l0aG91dCBhIGNoZWNrcG9pbnQsJywgKCkgPT4ge1xuICAgICAgYmVmb3JlRWFjaCggKCkgPT4ge1xuICAgICAgICBkaXNwYXRjaGVyLmhhbmRsZUFjdGlvbiggVWlVbmRvKCkgKTtcbiAgICAgIH0gKTtcblxuICAgICAgaXQoICdkb2VzIG5vdGhpbmcnLCAoKSA9PiB7XG4gICAgICAgIGV4cGVjdCggc3RvcmUuY2hlY2twb2ludHMudG9KUygpICkudG9FcXVhbCggW10gKTtcbiAgICAgICAgZXhwZWN0KCBzdG9yZS5ub3cgKS50b0VxdWFsKCAwICk7XG4gICAgICAgIGV4cGVjdCggc3RvcmUuc3RvcmVMb2dzLnRvSlMoKSApLnRvRXF1YWwoe1xuICAgICAgICAgIEE6IFsgeyBhdDogMCwgc3RhdGU6ICdBMScgfSBdLFxuICAgICAgICAgIEI6IFsgeyBhdDogMCwgc3RhdGU6ICdCMScgfSBdXG4gICAgICAgIH0pO1xuICAgICAgfSApO1xuICAgIH0gKTtcblxuXG4gICAgZGVzY3JpYmUoICdhbmQgdG8gc2F2ZSBtb3JlIHN0YXRlIGJlZm9yZSB0aGUgbmV4dCBjaGVja3BvaW50LCcsICgpID0+IHtcbiAgICAgIGJlZm9yZUVhY2goICgpID0+IHtcbiAgICAgICAgZGlzcGF0Y2hlci5oYW5kbGVBY3Rpb24oIFNhdmVTdGF0ZSh7IHN0b3JlSWQ6ICdBJywgc3RhdGU6ICdBMicgfSkgKTtcbiAgICAgICAgZGlzcGF0Y2hlci5oYW5kbGVBY3Rpb24oIFNhdmVTdGF0ZSh7IHN0b3JlSWQ6ICdCJywgc3RhdGU6ICdCMicgfSkgKTtcbiAgICAgICAgZGlzcGF0Y2hlci5oYW5kbGVBY3Rpb24oIFNhdmVTdGF0ZSh7IHN0b3JlSWQ6ICdCJywgc3RhdGU6ICdCMycgfSkgKTtcbiAgICAgIH0gKTtcblxuICAgICAgaXQoICdyZXBsYWNlcyB0aGUgcHJldmlvdXMgc3RhdGUnLCAoKSA9PiB7XG4gICAgICAgIGV4cGVjdCggc3RvcmUuc3RvcmVMb2dzLnRvSlMoKSApLnRvRXF1YWwoe1xuICAgICAgICAgIEE6IFsgeyBhdDogMCwgc3RhdGU6ICdBMicgfSBdLFxuICAgICAgICAgIEI6IFsgeyBhdDogMCwgc3RhdGU6ICdCMycgfSBdXG4gICAgICAgIH0pO1xuICAgICAgfSApO1xuICAgIH0gKTtcblxuICB9ICk7XG5cbn0gKTtcblxuZXhwb3J0IGRlZmF1bHQge307XG4iXX0=