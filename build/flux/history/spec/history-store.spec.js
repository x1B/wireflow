define(['exports', 'module', '../history-store', '../history-actions', '../../../testing/dispatcher-mock'], function (exports, module, _historyStore, _historyActions, _testingDispatcherMock) {'use strict';function _interopRequireDefault(obj) {return obj && obj.__esModule ? obj : { 'default': obj };}var _HistoryStore = _interopRequireDefault(_historyStore);var _DispatcherMock = _interopRequireDefault(_testingDispatcherMock);







  // Jasmine:
  var jasmine = window.jasmine;var describe = window.describe;var beforeEach = window.beforeEach;var expect = window.expect;var it = window.it;var 
  any = jasmine.any;

  describe('A history store', function () {

    var dispatcher;
    var store;

    beforeEach(function () {
      dispatcher = new _DispatcherMock['default']();
      store = new _HistoryStore['default'](dispatcher);});



    it('handles history actions', function () {
      expect(dispatcher.register).
      toHaveBeenCalledWith(_historyActions.SaveState, any(Function));
      expect(dispatcher.register).
      toHaveBeenCalledWith(_historyActions.CreateCheckpoint, any(Function));
      expect(dispatcher.register).
      toHaveBeenCalledWith(_historyActions.UiUndo, any(Function));
      expect(dispatcher.register).
      toHaveBeenCalledWith(_historyActions.UiRedo, any(Function));});



    it('begins with an empty log', function () {
      expect(store.checkpoints.toJS()).toEqual([]);
      expect(store.now).toEqual(0);
      expect(store.storeLogs.toJS()).toEqual({});});



    describe('asked to create a checkpoint,', function () {
      beforeEach(function () {
        dispatcher.handleAction((0, _historyActions.CreateCheckpoint)({ before: 'set.to.A1' }));});


      it('inserts a checkpoint', function () {
        expect(store.checkpoints.toJS()).toEqual([
        { at: 1, before: 'set.to.A1' }]);

        expect(store.now).toEqual(2);
        expect(store.storeLogs.toJS()).toEqual({});});



      describe('then asked to save state,', function () {

        beforeEach(function () {
          dispatcher.handleAction((0, _historyActions.SaveState)({ storeId: 'A', state: 'A1' }));});


        it('saves state to the log', function () {
          expect(store.storeLogs.toJS()).toEqual({ 
            A: [{ at: 2, state: 'A1' }] });});});});








    describe('asked to save state,', function () {

      beforeEach(function () {
        dispatcher.handleAction((0, _historyActions.SaveState)({ storeId: 'A', state: 'A1' }));
        dispatcher.handleAction((0, _historyActions.SaveState)({ storeId: 'B', state: 'B1' }));});


      it('saves state to the log', function () {
        expect(store.storeLogs.toJS()).toEqual({ 
          A: [{ at: 0, state: 'A1' }], 
          B: [{ at: 0, state: 'B1' }] });});




      describe('then to create a checkpoint,', function () {
        beforeEach(function () {
          dispatcher.handleAction((0, _historyActions.CreateCheckpoint)({ before: 'set.to.A2' }));});


        it('inserts a checkpoint', function () {
          expect(store.checkpoints.toJS()).toEqual([
          { at: 1, before: 'set.to.A2' }]);

          expect(store.now).toEqual(2);});


        it('keeps store log contents', function () {
          expect(store.storeLogs.toJS()).toEqual({ 
            A: [{ at: 0, state: 'A1' }], 
            B: [{ at: 0, state: 'B1' }] });});




        describe('and then to save more state,', function () {
          beforeEach(function () {
            dispatcher.handleAction((0, _historyActions.SaveState)({ storeId: 'A', state: 'A2' }));
            dispatcher.handleAction((0, _historyActions.SaveState)({ storeId: 'B', state: 'B1' }));});


          it('appends new state to the store log', function () {
            expect(store.storeLogs.get('A').toJS()).toEqual(
            [{ at: 0, state: 'A1' }, { at: 2, state: 'A2' }]);});



          it('does not touch the store log where contents remain the same', function () {
            expect(store.storeLogs.get('B').toJS()).toEqual(
            [{ at: 0, state: 'B1' }]);});



          describe('then to undo,', function () {

            beforeEach(function () {
              dispatcher.dispatch.calls.reset();
              dispatcher.handleAction((0, _historyActions.UiUndo)());});


            it('restores the previous state from the store log', function () {
              expect(dispatcher.dispatch).toHaveBeenCalledWith(
              (0, _historyActions.RestoreState)({ storeId: 'A', state: 'A1' }));});



            it('does not restore state if untouched since checkpoint', function () {
              expect(dispatcher.dispatch).not.toHaveBeenCalledWith(
              (0, _historyActions.RestoreState)({ storeId: 'B', state: 'B1' }));});



            it('does not remove store log entries', function () {
              expect(store.storeLogs.toJS()).toEqual({ 
                A: [{ at: 0, state: 'A1' }, { at: 2, state: 'A2' }], 
                B: [{ at: 0, state: 'B1' }] });});



            describe('and then to redo,', function () {
              beforeEach(function () {
                dispatcher.dispatch.calls.reset();
                dispatcher.handleAction((0, _historyActions.UiRedo)());});


              it('restores the more recent state from the store log', function () {
                var restore = dispatcher.dispatch.calls.mostRecent().args[0];
                expect(restore.toJS()).toEqual(
                { storeId: 'A', state: 'A2', type: (0, _historyActions.RestoreState)().type });});



              it('does not remove store log entries', function () {
                expect(store.storeLogs.toJS()).toEqual({ 
                  A: [{ at: 0, state: 'A1' }, { at: 2, state: 'A2' }], 
                  B: [{ at: 0, state: 'B1' }] });});});




            describe('and then to create a new checkpoint,', function () {
              beforeEach(function () {return dispatcher.handleAction(
                (0, _historyActions.CreateCheckpoint)({ before: 'set.to.A2x' }));});


              it('discards any rewound states from the store log', function () {
                expect(store.storeLogs.toJS()).toEqual({ 
                  A: [{ at: 0, state: 'A1' }], 
                  B: [{ at: 0, state: 'B1' }] });});



              it('replaces any rewound checkpoints with the new one', function () {
                expect(store.checkpoints.toJS()).toEqual([
                { at: 1, before: 'set.to.A2x' }]);});});});});});












      describe('then asked to undo without a checkpoint,', function () {
        beforeEach(function () {
          dispatcher.handleAction((0, _historyActions.UiUndo)());});


        it('does nothing', function () {
          expect(store.checkpoints.toJS()).toEqual([]);
          expect(store.now).toEqual(0);
          expect(store.storeLogs.toJS()).toEqual({ 
            A: [{ at: 0, state: 'A1' }], 
            B: [{ at: 0, state: 'B1' }] });});});





      describe('and to save more state before the next checkpoint,', function () {
        beforeEach(function () {
          dispatcher.handleAction((0, _historyActions.SaveState)({ storeId: 'A', state: 'A2' }));
          dispatcher.handleAction((0, _historyActions.SaveState)({ storeId: 'B', state: 'B2' }));
          dispatcher.handleAction((0, _historyActions.SaveState)({ storeId: 'B', state: 'B3' }));});


        it('replaces the previous state', function () {
          expect(store.storeLogs.toJS()).toEqual({ 
            A: [{ at: 0, state: 'A2' }], 
            B: [{ at: 0, state: 'B3' }] });});});});});module.exports = 








  {};});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL3NyYy9mbHV4L2hpc3Rvcnkvc3BlYy9oaXN0b3J5LXN0b3JlLnNwZWMuanN4Il0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7Ozs7OztNQVNRLE9BQU8sR0FBdUMsTUFBTSxDQUFwRCxPQUFPLEtBQUUsUUFBUSxHQUE2QixNQUFNLENBQTNDLFFBQVEsS0FBRSxVQUFVLEdBQWlCLE1BQU0sQ0FBakMsVUFBVSxLQUFFLE1BQU0sR0FBUyxNQUFNLENBQXJCLE1BQU0sS0FBRSxFQUFFLEdBQUssTUFBTSxDQUFiLEVBQUU7QUFDekMsS0FBRyxHQUFLLE9BQU8sQ0FBZixHQUFHOztBQUVYLFVBQVEsQ0FBRSxpQkFBaUIsRUFBRSxZQUFNOztBQUVqQyxRQUFJLFVBQVUsQ0FBQztBQUNmLFFBQUksS0FBSyxDQUFDOztBQUVWLGNBQVUsQ0FBRSxZQUFNO0FBQ2hCLGdCQUFVLEdBQUcsZ0NBQW9CLENBQUM7QUFDbEMsV0FBSyxHQUFHLDZCQUFrQixVQUFVLENBQUUsQ0FBQyxDQUN4QyxDQUFFLENBQUM7Ozs7QUFHSixNQUFFLENBQUUseUJBQXlCLEVBQUUsWUFBTTtBQUNuQyxZQUFNLENBQUUsVUFBVSxDQUFDLFFBQVEsQ0FBRTtBQUMxQiwwQkFBb0IsaUJBdkJQLFNBQVMsRUF1QlcsR0FBRyxDQUFFLFFBQVEsQ0FBRSxDQUFFLENBQUM7QUFDdEQsWUFBTSxDQUFFLFVBQVUsQ0FBQyxRQUFRLENBQUU7QUFDMUIsMEJBQW9CLGlCQXpCekIsZ0JBQWdCLEVBeUI2QixHQUFHLENBQUUsUUFBUSxDQUFFLENBQUUsQ0FBQztBQUM3RCxZQUFNLENBQUUsVUFBVSxDQUFDLFFBQVEsQ0FBRTtBQUMxQiwwQkFBb0IsaUJBM0JrQixNQUFNLEVBMkJkLEdBQUcsQ0FBRSxRQUFRLENBQUUsQ0FBRSxDQUFDO0FBQ25ELFlBQU0sQ0FBRSxVQUFVLENBQUMsUUFBUSxDQUFFO0FBQzFCLDBCQUFvQixpQkE3QjBCLE1BQU0sRUE2QnRCLEdBQUcsQ0FBRSxRQUFRLENB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RyxFQUFFLEtBQUssRUFBRSxJQUFJLEVBQUUsQ0FBQyxDQUFFLENBQUM7QUFDcEUsb0JBQVUsQ0FBQyxZQUFZLENBQUUsb0JBek5iLFNBQVMsRUF5TmMsRUFBRSxPQUFPLEVBQUUsR0FBRyxFQUFFLEtBQUssRUFBRSxJQUFJLEVBQUUsQ0FBQyxDQUFFLENBQUM7QUFDcEUsb0JBQVUsQ0FBQyxZQUFZLENBQUUsb0JBMU5iLFNBQVMsRUEwTmMsRUFBRSxPQUFPLEVBQUUsR0FBRyxFQUFFLEtBQUssRUFBRSxJQUFJLEVBQUUsQ0FBQyxDQUFFLENBQUMsQ0FDckUsQ0FBRSxDQUFDOzs7QUFFSixVQUFFLENBQUUsNkJBQTZCLEVBQUUsWUFBTTtBQUN2QyxnQkFBTSxDQUFFLEtBQUssQ0FBQyxTQUFTLENBQUMsSUFBSSxFQUFFLENBQUUsQ0FBQyxPQUFPLENBQUM7QUFDdkMsYUFBQyxFQUFFLENBQUUsRUFBRSxFQUFFLEVBQUUsQ0FBQyxFQUFFLEtBQUssRUFBRSxJQUFJLEVBQUUsQ0FBRTtBQUM3QixhQUFDLEVBQUUsQ0FBRSxFQUFFLEVBQUUsRUFBRSxDQUFDLEVBQUUsS0FBSyxFQUFFLElBQUksRUFBRSxDQUFFLEVBQzlCLENBQUMsQ0FBQyxDQUNKLENBQUUsQ0FBQyxDQUNMLENBQUUsQ0FBQyxDQUVMLENBQUUsQ0FBQyxDQUVMLENBQUUsQ0FBQzs7Ozs7Ozs7O0FBRVcsSUFBRSIsImZpbGUiOiJoaXN0b3J5LXN0b3JlLnNwZWMuanMiLCJzb3VyY2VSb290Ijoic3JjIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IEhpc3RvcnlTdG9yZSBmcm9tICcuLi9oaXN0b3J5LXN0b3JlJztcbmltcG9ydCB7XG4gIENyZWF0ZUNoZWNrcG9pbnQsIFNhdmVTdGF0ZSwgUmVzdG9yZVN0YXRlLCBVaVVuZG8sIFVpUmVkb1xufSBmcm9tICcuLi9oaXN0b3J5LWFjdGlvbnMnO1xuXG5pbXBvcnQgRGlzcGF0Y2hlck1vY2sgZnJvbSAnLi4vLi4vLi4vdGVzdGluZy9kaXNwYXRjaGVyLW1vY2snO1xuXG5cbi8vIEphc21pbmU6XG5jb25zdCB7IGphc21pbmUsIGRlc2NyaWJlLCBiZWZvcmVFYWNoLCBleHBlY3QsIGl0IH0gPSB3aW5kb3c7XG5jb25zdCB7IGFueSB9ID0gamFzbWluZTtcblxuZGVzY3JpYmUoICdBIGhpc3Rvcnkgc3RvcmUnLCAoKSA9PiB7XG5cbiAgdmFyIGRpc3BhdGNoZXI7XG4gIHZhciBzdG9yZTtcblxuICBiZWZvcmVFYWNoKCAoKSA9PiB7XG4gICAgZGlzcGF0Y2hlciA9IG5ldyBEaXNwYXRjaGVyTW9jaygpO1xuICAgIHN0b3JlID0gbmV3IEhpc3RvcnlTdG9yZSggZGlzcGF0Y2hlciApO1xuICB9ICk7XG5cblxuICBpdCggJ2hhbmRsZXMgaGlzdG9yeSBhY3Rpb25zJywgKCkgPT4ge1xuICAgIGV4cGVjdCggZGlzcGF0Y2hlci5yZWdpc3RlciApXG4gICAgICAudG9IYXZlQmVlbkNhbGxlZFdpdGgoIFNhdmVTdGF0ZSwgYW55KCBGdW5jdGlvbiApICk7XG4gICAgZXhwZWN0KCBkaXNwYXRjaGVyLnJlZ2lzdGVyIClcbiAgICAgIC50b0hhdmVCZWVuQ2FsbGVkV2l0aCggQ3JlYXRlQ2hlY2twb2ludCwgYW55KCBGdW5jdGlvbiApICk7XG4gICAgZXhwZWN0KCBkaXNwYXRjaGVyLnJlZ2lzdGVyIClcbiAgICAgIC50b0hhdmVCZWVuQ2FsbGVkV2l0aCggVWlVbmRvLCBhbnkoIEZ1bmN0aW9uICkgKTtcbiAgICBleHBlY3QoIGRpc3BhdGNoZXIucmVnaXN0ZXIgKVxuICAgICAgLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKCBVaVJlZG8sIGFueSggRnVuY3Rpb24gKSApO1xuICB9ICk7XG5cblxuICBpdCggJ2JlZ2lucyB3aXRoIGFuIGVtcHR5IGxvZycsICgpID0+IHtcbiAgICBleHBlY3QoIHN0b3JlLmNoZWNrcG9pbnRzLnRvSlMoKSApLnRvRXF1YWwoIFtdICk7XG4gICAgZXhwZWN0KCBzdG9yZS5ub3cgKS50b0VxdWFsKCAwICk7XG4gICAgZXhwZWN0KCBzdG9yZS5zdG9yZUxvZ3MudG9KUygpICkudG9FcXVhbCgge30gKTtcbiAgfSApO1xuXG5cbiAgZGVzY3JpYmUoICdhc2tlZCB0byBjcmVhdGUgYSBjaGVja3BvaW50LCcsICgpID0+IHtcbiAgICBiZWZvcmVFYWNoKCAoKSA9PiB7XG4gICAgICBkaXNwYXRjaGVyLmhhbmRsZUFjdGlvbiggQ3JlYXRlQ2hlY2twb2ludCh7IGJlZm9yZTogJ3NldC50by5BMScgfSkgKTtcbiAgICB9ICk7XG5cbiAgICBpdCggJ2luc2VydHMgYSBjaGVja3BvaW50JywgKCkgPT4ge1xuICAgICAgZXhwZWN0KCBzdG9yZS5jaGVja3BvaW50cy50b0pTKCkgKS50b0VxdWFsKFtcbiAgICAgICAgeyBhdDogMSwgYmVmb3JlOiAnc2V0LnRvLkExJyB9XG4gICAgICBdKTtcbiAgICAgIGV4cGVjdCggc3RvcmUubm93ICkudG9FcXVhbCggMiApO1xuICAgICAgZXhwZWN0KCBzdG9yZS5zdG9yZUxvZ3MudG9KUygpICkudG9FcXVhbCgge30gKTtcbiAgICB9ICk7XG5cblxuICAgIGRlc2NyaWJlKCAndGhlbiBhc2tlZCB0byBzYXZlIHN0YXRlLCcsICgpID0+IHtcblxuICAgICAgYmVmb3JlRWFjaCggKCkgPT4ge1xuICAgICAgICBkaXNwYXRjaGVyLmhhbmRsZUFjdGlvbiggU2F2ZVN0YXRlKHsgc3RvcmVJZDogJ0EnLCBzdGF0ZTogJ0ExJyB9KSApO1xuICAgICAgfSApO1xuXG4gICAgICBpdCggJ3NhdmVzIHN0YXRlIHRvIHRoZSBsb2cnLCAoKSA9PiB7XG4gICAgICAgIGV4cGVjdCggc3RvcmUuc3RvcmVMb2dzLnRvSlMoKSApLnRvRXF1YWwoe1xuICAgICAgICAgIEE6IFsgeyBhdDogMiwgc3RhdGU6ICdBMScgfSBdXG4gICAgICAgIH0pO1xuICAgICAgfSApO1xuXG4gICAgfSApO1xuXG4gIH0gKTtcblxuXG4gIGRlc2NyaWJlKCAnYXNrZWQgdG8gc2F2ZSBzdGF0ZSwnLCAoKSA9PiB7XG5cbiAgICBiZWZvcmVFYWNoKCAoKSA9PiB7XG4gICAgICBkaXNwYXRjaGVyLmhhbmRsZUFjdGlvbiggU2F2ZVN0YXRlKHsgc3RvcmVJZDogJ0EnLCBzdGF0ZTogJ0ExJyB9KSApO1xuICAgICAgZGlzcGF0Y2hlci5oYW5kbGVBY3Rpb24oIFNhdmVTdGF0ZSh7IHN0b3JlSWQ6ICdCJywgc3RhdGU6ICdCMScgfSkgKTtcbiAgICB9ICk7XG5cbiAgICBpdCggJ3NhdmVzIHN0YXRlIHRvIHRoZSBsb2cnLCAoKSA9PiB7XG4gICAgICBleHBlY3QoIHN0b3JlLnN0b3JlTG9ncy50b0pTKCkgKS50b0VxdWFsKHtcbiAgICAgICAgQTogWyB7IGF0OiAwLCBzdGF0ZTogJ0ExJyB9IF0sXG4gICAgICAgIEI6IFsgeyBhdDogMCwgc3RhdGU6ICdCMScgfSBdXG4gICAgICB9KTtcbiAgICB9ICk7XG5cblxuICAgIGRlc2NyaWJlKCAndGhlbiB0byBjcmVhdGUgYSBjaGVja3BvaW50LCcsICgpID0+IHtcbiAgICAgIGJlZm9yZUVhY2goICgpID0+IHtcbiAgICAgICAgZGlzcGF0Y2hlci5oYW5kbGVBY3Rpb24oIENyZWF0ZUNoZWNrcG9pbnQoeyBiZWZvcmU6ICdzZXQudG8uQTInIH0pICk7XG4gICAgICB9ICk7XG5cbiAgICAgIGl0KCAnaW5zZXJ0cyBhIGNoZWNrcG9pbnQnLCAoKSA9PiB7XG4gICAgICAgIGV4cGVjdCggc3RvcmUuY2hlY2twb2ludHMudG9KUygpICkudG9FcXVhbChbXG4gICAgICAgICAgeyBhdDogMSwgYmVmb3JlOiAnc2V0LnRvLkEyJyB9XG4gICAgICAgIF0pO1xuICAgICAgICBleHBlY3QoIHN0b3JlLm5vdyApLnRvRXF1YWwoIDIgKTtcbiAgICAgIH0pO1xuXG4gICAgICBpdCggJ2tlZXBzIHN0b3JlIGxvZyBjb250ZW50cycsICgpID0+IHtcbiAgICAgICAgZXhwZWN0KCBzdG9yZS5zdG9yZUxvZ3MudG9KUygpICkudG9FcXVhbCh7XG4gICAgICAgICAgQTogWyB7IGF0OiAwLCBzdGF0ZTogJ0ExJyB9IF0sXG4gICAgICAgICAgQjogWyB7IGF0OiAwLCBzdGF0ZTogJ0IxJyB9IF1cbiAgICAgICAgfSk7XG4gICAgICB9ICk7XG5cblxuICAgICAgZGVzY3JpYmUoICdhbmQgdGhlbiB0byBzYXZlIG1vcmUgc3RhdGUsJywgKCkgPT4ge1xuICAgICAgICBiZWZvcmVFYWNoKCAoKSA9PiB7XG4gICAgICAgICAgZGlzcGF0Y2hlci5oYW5kbGVBY3Rpb24oIFNhdmVTdGF0ZSh7IHN0b3JlSWQ6ICdBJywgc3RhdGU6ICdBMicgfSkgKTtcbiAgICAgICAgICBkaXNwYXRjaGVyLmhhbmRsZUFjdGlvbiggU2F2ZVN0YXRlKHsgc3RvcmVJZDogJ0InLCBzdGF0ZTogJ0IxJyB9KSApO1xuICAgICAgICB9ICk7XG5cbiAgICAgICAgaXQoICdhcHBlbmRzIG5ldyBzdGF0ZSB0byB0aGUgc3RvcmUgbG9nJywgKCkgPT4ge1xuICAgICAgICAgIGV4cGVjdCggc3RvcmUuc3RvcmVMb2dzLmdldCggJ0EnICkudG9KUygpICkudG9FcXVhbChcbiAgICAgICAgICAgIFsgeyBhdDogMCwgc3RhdGU6ICdBMScgfSwgeyBhdDogMiwgc3RhdGU6ICdBMicgfSBdXG4gICAgICAgICAgKTtcbiAgICAgICAgfSApO1xuXG4gICAgICAgIGl0KCAnZG9lcyBub3QgdG91Y2ggdGhlIHN0b3JlIGxvZyB3aGVyZSBjb250ZW50cyByZW1haW4gdGhlIHNhbWUnLCAoKSA9PiB7XG4gICAgICAgICAgZXhwZWN0KCBzdG9yZS5zdG9yZUxvZ3MuZ2V0KCAnQicgKS50b0pTKCkgKS50b0VxdWFsKFxuICAgICAgICAgICAgWyB7IGF0OiAwLCBzdGF0ZTogJ0IxJyB9IF1cbiAgICAgICAgICApO1xuICAgICAgICB9ICk7XG5cbiAgICAgICAgZGVzY3JpYmUoICd0aGVuIHRvIHVuZG8sJywgKCkgPT4ge1xuXG4gICAgICAgICAgYmVmb3JlRWFjaCggKCkgPT4ge1xuICAgICAgICAgICAgZGlzcGF0Y2hlci5kaXNwYXRjaC5jYWxscy5yZXNldCgpO1xuICAgICAgICAgICAgZGlzcGF0Y2hlci5oYW5kbGVBY3Rpb24oIFVpVW5kbygpICk7XG4gICAgICAgICAgfSApO1xuXG4gICAgICAgICAgaXQoICdyZXN0b3JlcyB0aGUgcHJldmlvdXMgc3RhdGUgZnJvbSB0aGUgc3RvcmUgbG9nJywgKCkgPT4ge1xuICAgICAgICAgICAgZXhwZWN0KCBkaXNwYXRjaGVyLmRpc3BhdGNoICkudG9IYXZlQmVlbkNhbGxlZFdpdGgoXG4gICAgICAgICAgICAgIFJlc3RvcmVTdGF0ZSh7IHN0b3JlSWQ6ICdBJywgc3RhdGU6ICdBMScgfSlcbiAgICAgICAgICAgICk7XG4gICAgICAgICAgfSApO1xuXG4gICAgICAgICAgaXQoICdkb2VzIG5vdCByZXN0b3JlIHN0YXRlIGlmIHVudG91Y2hlZCBzaW5jZSBjaGVja3BvaW50JywgKCkgPT4ge1xuICAgICAgICAgICAgZXhwZWN0KCBkaXNwYXRjaGVyLmRpc3BhdGNoICkubm90LnRvSGF2ZUJlZW5DYWxsZWRXaXRoKFxuICAgICAgICAgICAgICBSZXN0b3JlU3RhdGUoeyBzdG9yZUlkOiAnQicsIHN0YXRlOiAnQjEnIH0pXG4gICAgICAgICAgICApO1xuICAgICAgICAgIH0gKTtcblxuICAgICAgICAgIGl0KCAnZG9lcyBub3QgcmVtb3ZlIHN0b3JlIGxvZyBlbnRyaWVzJywgKCkgPT4ge1xuICAgICAgICAgICAgZXhwZWN0KCBzdG9yZS5zdG9yZUxvZ3MudG9KUygpICkudG9FcXVhbCh7XG4gICAgICAgICAgICAgIEE6IFsgeyBhdDogMCwgc3RhdGU6ICdBMScgfSwgeyBhdDogMiwgc3RhdGU6ICdBMicgfSBdLFxuICAgICAgICAgICAgICBCOiBbIHsgYXQ6IDAsIHN0YXRlOiAnQjEnIH0gXVxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgfSApO1xuXG4gICAgICAgICAgZGVzY3JpYmUoICdhbmQgdGhlbiB0byByZWRvLCcsICgpID0+IHtcbiAgICAgICAgICAgIGJlZm9yZUVhY2goICgpID0+IHtcbiAgICAgICAgICAgICAgZGlzcGF0Y2hlci5kaXNwYXRjaC5jYWxscy5yZXNldCgpO1xuICAgICAgICAgICAgICBkaXNwYXRjaGVyLmhhbmRsZUFjdGlvbiggVWlSZWRvKCkgKTtcbiAgICAgICAgICAgIH0gKTtcblxuICAgICAgICAgICAgaXQoICdyZXN0b3JlcyB0aGUgbW9yZSByZWNlbnQgc3RhdGUgZnJvbSB0aGUgc3RvcmUgbG9nJywgKCkgPT4ge1xuICAgICAgICAgICAgICBjb25zdCByZXN0b3JlID0gZGlzcGF0Y2hlci5kaXNwYXRjaC5jYWxscy5tb3N0UmVjZW50KCkuYXJnc1sgMCBdO1xuICAgICAgICAgICAgICBleHBlY3QoIHJlc3RvcmUudG9KUygpICkudG9FcXVhbChcbiAgICAgICAgICAgICAgICB7IHN0b3JlSWQ6ICdBJywgc3RhdGU6ICdBMicsIHR5cGU6IFJlc3RvcmVTdGF0ZSgpLnR5cGUgfVxuICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgfSApO1xuXG4gICAgICAgICAgICBpdCggJ2RvZXMgbm90IHJlbW92ZSBzdG9yZSBsb2cgZW50cmllcycsICgpID0+IHtcbiAgICAgICAgICAgICAgZXhwZWN0KCBzdG9yZS5zdG9yZUxvZ3MudG9KUygpICkudG9FcXVhbCh7XG4gICAgICAgICAgICAgICAgQTogWyB7IGF0OiAwLCBzdGF0ZTogJ0ExJyB9LCB7IGF0OiAyLCBzdGF0ZTogJ0EyJyB9IF0sXG4gICAgICAgICAgICAgICAgQjogWyB7IGF0OiAwLCBzdGF0ZTogJ0IxJyB9IF1cbiAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9ICk7XG4gICAgICAgICAgfSApO1xuXG4gICAgICAgICAgZGVzY3JpYmUoICdhbmQgdGhlbiB0byBjcmVhdGUgYSBuZXcgY2hlY2twb2ludCwnLCAoKSA9PiB7XG4gICAgICAgICAgICBiZWZvcmVFYWNoKCAoKSA9PiBkaXNwYXRjaGVyLmhhbmRsZUFjdGlvbihcbiAgICAgICAgICAgICAgQ3JlYXRlQ2hlY2twb2ludCh7IGJlZm9yZTogJ3NldC50by5BMngnIH0pXG4gICAgICAgICAgICApICk7XG5cbiAgICAgICAgICAgIGl0KCAnZGlzY2FyZHMgYW55IHJld291bmQgc3RhdGVzIGZyb20gdGhlIHN0b3JlIGxvZycsICgpID0+IHtcbiAgICAgICAgICAgICAgZXhwZWN0KCBzdG9yZS5zdG9yZUxvZ3MudG9KUygpICkudG9FcXVhbCh7XG4gICAgICAgICAgICAgICAgQTogWyB7IGF0OiAwLCBzdGF0ZTogJ0ExJyB9IF0sXG4gICAgICAgICAgICAgICAgQjogWyB7IGF0OiAwLCBzdGF0ZTogJ0IxJyB9IF1cbiAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9ICk7XG5cbiAgICAgICAgICAgIGl0KCAncmVwbGFjZXMgYW55IHJld291bmQgY2hlY2twb2ludHMgd2l0aCB0aGUgbmV3IG9uZScsICgpID0+IHtcbiAgICAgICAgICAgICAgZXhwZWN0KCBzdG9yZS5jaGVja3BvaW50cy50b0pTKCkgKS50b0VxdWFsKFtcbiAgICAgICAgICAgICAgICB7IGF0OiAxLCBiZWZvcmU6ICdzZXQudG8uQTJ4JyB9XG4gICAgICAgICAgICAgIF0pO1xuICAgICAgICAgICAgfSApO1xuXG4gICAgICAgICAgfSApO1xuXG4gICAgICAgIH0gKTtcblxuICAgICAgfSApO1xuXG4gICAgfSApO1xuXG5cbiAgICBkZXNjcmliZSggJ3RoZW4gYXNrZWQgdG8gdW5kbyB3aXRob3V0IGEgY2hlY2twb2ludCwnLCAoKSA9PiB7XG4gICAgICBiZWZvcmVFYWNoKCAoKSA9PiB7XG4gICAgICAgIGRpc3BhdGNoZXIuaGFuZGxlQWN0aW9uKCBVaVVuZG8oKSApO1xuICAgICAgfSApO1xuXG4gICAgICBpdCggJ2RvZXMgbm90aGluZycsICgpID0+IHtcbiAgICAgICAgZXhwZWN0KCBzdG9yZS5jaGVja3BvaW50cy50b0pTKCkgKS50b0VxdWFsKCBbXSApO1xuICAgICAgICBleHBlY3QoIHN0b3JlLm5vdyApLnRvRXF1YWwoIDAgKTtcbiAgICAgICAgZXhwZWN0KCBzdG9yZS5zdG9yZUxvZ3MudG9KUygpICkudG9FcXVhbCh7XG4gICAgICAgICAgQTogWyB7IGF0OiAwLCBzdGF0ZTogJ0ExJyB9IF0sXG4gICAgICAgICAgQjogWyB7IGF0OiAwLCBzdGF0ZTogJ0IxJyB9IF1cbiAgICAgICAgfSk7XG4gICAgICB9ICk7XG4gICAgfSApO1xuXG5cbiAgICBkZXNjcmliZSggJ2FuZCB0byBzYXZlIG1vcmUgc3RhdGUgYmVmb3JlIHRoZSBuZXh0IGNoZWNrcG9pbnQsJywgKCkgPT4ge1xuICAgICAgYmVmb3JlRWFjaCggKCkgPT4ge1xuICAgICAgICBkaXNwYXRjaGVyLmhhbmRsZUFjdGlvbiggU2F2ZVN0YXRlKHsgc3RvcmVJZDogJ0EnLCBzdGF0ZTogJ0EyJyB9KSApO1xuICAgICAgICBkaXNwYXRjaGVyLmhhbmRsZUFjdGlvbiggU2F2ZVN0YXRlKHsgc3RvcmVJZDogJ0InLCBzdGF0ZTogJ0IyJyB9KSApO1xuICAgICAgICBkaXNwYXRjaGVyLmhhbmRsZUFjdGlvbiggU2F2ZVN0YXRlKHsgc3RvcmVJZDogJ0InLCBzdGF0ZTogJ0IzJyB9KSApO1xuICAgICAgfSApO1xuXG4gICAgICBpdCggJ3JlcGxhY2VzIHRoZSBwcmV2aW91cyBzdGF0ZScsICgpID0+IHtcbiAgICAgICAgZXhwZWN0KCBzdG9yZS5zdG9yZUxvZ3MudG9KUygpICkudG9FcXVhbCh7XG4gICAgICAgICAgQTogWyB7IGF0OiAwLCBzdGF0ZTogJ0EyJyB9IF0sXG4gICAgICAgICAgQjogWyB7IGF0OiAwLCBzdGF0ZTogJ0IzJyB9IF1cbiAgICAgICAgfSk7XG4gICAgICB9ICk7XG4gICAgfSApO1xuXG4gIH0gKTtcblxufSApO1xuXG5leHBvcnQgZGVmYXVsdCB7fTtcbiJdfQ==